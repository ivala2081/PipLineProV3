import{r as e,j as t,m as s,X as a,e as r,n,o as l,u as i,d as c,E as o,x as d,y as m,aH as x,Z as h,U as u,bj as g,F as p,I as y,k as j,_ as b,p as f,v as _,l as N,D as v,aY as w,bl as C,bi as S,i as k,c as D,q as A,b2 as E,aT as T,R,h as P,B as L,bm as F,t as U,w as $}from"./vendor-react-X8uUzP0t.js";import{u as O,C as I,M,T as z}from"./pages-C9OTfaPt.js";import{b as B,a as W}from"./contexts-9IXokeH-.js";import{a as K,U as H,d as Y,b as V,n as q,g as J,T as G,f as X}from"./components-modern-DxUcFm15.js";import{d as Z,f as Q,g as ee,a as te,F as se,I as ae,l as re,m as ne,n as le,o as ie,p as ce,B as oe,s as de,t as me,u as xe,v as he}from"./components-ui-BYXC3pAy.js";import{R as ue,L as ge,b as pe,X as ye,Y as je,T as be,c as fe,P as _e,a as Ne,C as ve,g as we,B as Ce,d as Se}from"./vendor-charts-recharts-ipxjOH9-.js";import"./components-trust-CB39-DvV.js";import"./vendor-i18n-DHLiip7K.js";import"./vendor-utils-CtF19A-_.js";class ke extends Error{code;status;context;constructor(e,t,s,a){super(e),this.name="PipLineError",this.code=t,this.status=s,this.context=a}}class De{static instance;errorLog=[];maxLogSize=100;constructor(){}static getInstance(){return De.instance||(De.instance=new De),De.instance}handleApiError(e,t){let s="An unexpected error occurred",a="UNKNOWN_ERROR",r=500;if(e instanceof ke)return e;if(e.response){const t=e.response.data||{};s=t.message||t.error||"API request failed",a=t.code||`HTTP_${e.response.status}`,r=e.response.status}else e.request?(s="Network error - please check your connection",a="NETWORK_ERROR",r=0):e.message&&(s=e.message,a="GENERIC_ERROR");const n=new ke(s,a,r,{originalError:e,context:t,timestamp:(new Date).toISOString()});return this.logError(n),n}handleComponentError(e,t,s){const a=new ke(e.message,"COMPONENT_ERROR",0,{componentName:s,errorInfo:t,stack:e.stack,timestamp:(new Date).toISOString()});this.logError(a)}handleValidationError(e,t){const s=new ke(e,"VALIDATION_ERROR",400,{field:t,timestamp:(new Date).toISOString()});return this.logError(s),s}handleAuthError(e="Authentication required"){const t=new ke(e,"AUTH_ERROR",401,{timestamp:(new Date).toISOString()});return this.logError(t),t}handlePermissionError(e="Insufficient permissions"){const t=new ke(e,"PERMISSION_ERROR",403,{timestamp:(new Date).toISOString()});return this.logError(t),t}logError(e){const t={message:e.message,code:e.code,status:e.status,timestamp:(new Date).toISOString(),context:e.context};this.errorLog.unshift(t),this.errorLog.length>this.maxLogSize&&(this.errorLog=this.errorLog.slice(0,this.maxLogSize))}getErrorLog(){return[...this.errorLog]}clearErrorLog(){this.errorLog=[]}getUserFriendlyMessage(e){const t={NETWORK_ERROR:"Unable to connect to the server. Please check your internet connection and try again.",HTTP_401:"Your session has expired. Please log in again.",HTTP_403:"You do not have permission to perform this action.",HTTP_404:"The requested resource was not found.",HTTP_500:"A server error occurred. Please try again later.",HTTP_502:"The server is temporarily unavailable. Please try again in a few moments.",HTTP_503:"The service is temporarily unavailable. Please try again later.",HTTP_504:"The request took too long. Please try again.",VALIDATION_ERROR:"Please check your input and try again.",AUTH_ERROR:"Authentication failed. Please log in again.",PERMISSION_ERROR:"You do not have permission to perform this action.",TIMEOUT_ERROR:"The request took too long. Please try again.",COMPONENT_ERROR:"Something went wrong. Please refresh the page.",UNKNOWN_ERROR:"An unexpected error occurred. Please try again."},s=e.message||"";if(s.includes("Failed to fetch")||s.includes("NetworkError")||s.includes("network"))return"Connection problem. Please check your internet connection and try again.";if(s.includes("timeout")||s.includes("Timeout"))return"The request took too long. Please try again.";if(s.includes("validation")||s.includes("invalid")||s.includes("required"))return s.length<100&&!s.includes("Error")&&!s.includes("Exception")?s:"Please check your input and try again.";if(s.includes("database")||s.includes("SQL")||s.includes("constraint"))return"A data error occurred. Please check your input or contact support if the problem persists.";if(e.code&&t[e.code])return t[e.code];if(e.status){const s=t[`HTTP_${e.status}`];if(s)return s}return!/(error|exception|failed|undefined|null|NaN|stack|trace)/i.test(s)&&s.length<200&&s.trim().length>0?s:"An unexpected error occurred. Please try again or contact support if the problem persists."}isRetryable(e){return"NETWORK_ERROR"===e.code||e.status&&e.status>=500||0===e.status}getRetryDelay(e){return Math.min(1e3*Math.pow(2,e),1e4)}}const Ae=De.getInstance();function Ee({filters:e,dropdownOptions:i,expandedFilterSections:c,displayLimit:o,transactionsLength:d,exporting:m,onFilterChange:x,onToggleFilterSection:h,onClearAllFilters:u,onApplyFilters:g,onExportDisplayed:p,onExportAll:y,onApplyQuickFilter:j}){const{t:b}=B(),f=Object.values(e).filter(e=>e&&"created_at"!==e&&"desc"!==e&&"all"!==e).length;return t.jsxs(H,{variant:"outlined",className:"overflow-hidden border-slate-300 bg-white",children:[t.jsx(Z,{className:"bg-white border-b border-slate-200",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-slate-100 rounded-lg",children:t.jsx(s,{className:"h-5 w-5 text-slate-700"})}),t.jsxs("div",{children:[t.jsx(Q,{className:"text-lg font-semibold text-slate-900",children:"Transaction Filters"}),t.jsxs(ee,{className:"text-slate-600",children:["Filter and search transactions",f>0&&t.jsx("span",{className:"ml-2 px-2 py-0.5 bg-slate-900 text-white text-xs font-medium rounded",children:f})]})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[f>0&&t.jsx(Y,{variant:"outline",size:"sm",onClick:u,icon:t.jsx(a,{className:"h-4 w-4"}),className:"text-slate-700 hover:bg-slate-100 border-slate-300",children:"Clear All"}),t.jsx(Y,{variant:"ghost",size:"sm",onClick:()=>{},icon:t.jsx(a,{className:"h-4 w-4"}),className:"text-slate-600 hover:bg-slate-100",children:"Close"})]})]})}),t.jsx(te,{className:"p-6",children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-slate-50 border border-slate-200 rounded-lg p-4",children:[t.jsx("div",{className:"flex items-center gap-2 mb-3",children:t.jsx("h3",{className:"text-sm font-semibold text-slate-900",children:"Quick Filters"})}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsx(Y,{variant:"outline",size:"sm",onClick:()=>j("today"),className:"bg-white hover:bg-slate-100 border-slate-300 text-slate-700",children:"Today"}),t.jsx(Y,{variant:"outline",size:"sm",onClick:()=>j("thisWeek"),className:"bg-white hover:bg-slate-100 border-slate-300 text-slate-700",children:"This Week"}),t.jsx(Y,{variant:"outline",size:"sm",onClick:()=>j("deposits"),className:"bg-white hover:bg-slate-100 border-slate-300 text-slate-700",children:"Deposits"}),t.jsx(Y,{variant:"outline",size:"sm",onClick:()=>j("withdrawals"),className:"bg-white hover:bg-slate-100 border-slate-300 text-slate-700",children:"Withdrawals"}),t.jsx(Y,{variant:"outline",size:"sm",onClick:()=>j("highValue"),className:"bg-white hover:bg-slate-100 border-slate-300 text-slate-700",children:"High Value (â‚º10K+)"})]})]}),t.jsxs("div",{className:"border border-slate-200 rounded-lg overflow-hidden",children:[t.jsx("div",{className:"flex items-center justify-between cursor-pointer bg-slate-50 p-3 hover:bg-slate-100 transition-colors",onClick:()=>h("basic"),children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"transition-transform duration-200 "+(c.basic?"rotate-180":""),children:t.jsx(r,{className:"h-4 w-4 text-slate-600"})}),t.jsx("h3",{className:"text-sm font-semibold text-slate-900",children:"Basic Filters"}),(e.search||e.category&&"all"!==e.category||e.status&&"all"!==e.status)&&t.jsx(V,{variant:"secondary",size:"sm",className:"bg-slate-900 text-white",children:(e.search?1:0)+(e.category&&"all"!==e.category?1:0)+(e.status&&"all"!==e.status?1:0)})]})}),c.basic&&t.jsx("div",{className:"p-4 bg-white border-t border-slate-200",children:t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[t.jsx(se,{label:"Search",children:t.jsx(ae,{placeholder:"Search transactions...",variant:"default",size:"default",value:e.search,onChange:e=>x("search",e.target.value)})}),t.jsx(se,{label:"Category",children:t.jsxs(re,{value:e.category,onValueChange:e=>x("category",e),children:[t.jsx(ne,{variant:"default",size:"default",children:t.jsx(le,{placeholder:"All Categories"})}),t.jsxs(ie,{children:[t.jsx(ce,{value:"all",children:"All Categories"}),t.jsx(ce,{value:"DEP",children:"Deposit (DEP)"}),t.jsx(ce,{value:"WD",children:"Withdrawal (WD)"})]})]})}),t.jsx(se,{label:"Status",children:t.jsxs(re,{value:e.status,onValueChange:e=>x("status",e),children:[t.jsx(ne,{variant:"default",size:"default",children:t.jsx(le,{placeholder:"All Status"})}),t.jsxs(ie,{children:[t.jsx(ce,{value:"all",children:"All Status"}),t.jsx(ce,{value:"completed",children:"Completed"}),t.jsx(ce,{value:"pending",children:"Pending"}),t.jsx(ce,{value:"failed",children:"Failed"})]})]})})]})})]}),t.jsxs("div",{className:"border border-slate-200 rounded-lg overflow-hidden",children:[t.jsx("div",{className:"flex items-center justify-between cursor-pointer bg-slate-50 p-3 hover:bg-slate-100 transition-colors",onClick:()=>h("advanced"),children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"transition-transform duration-200 "+(c.advanced?"rotate-180":""),children:t.jsx(r,{className:"h-4 w-4 text-slate-600"})}),t.jsx("h3",{className:"text-sm font-semibold text-slate-900",children:"Advanced Filters"}),(e.psp&&"all"!==e.psp||e.company&&"all"!==e.company||e.payment_method&&"all"!==e.payment_method||e.currency&&"all"!==e.currency)&&t.jsx(V,{variant:"secondary",size:"sm",className:"bg-slate-900 text-white",children:(e.psp&&"all"!==e.psp?1:0)+(e.company&&"all"!==e.company?1:0)+(e.payment_method&&"all"!==e.payment_method?1:0)+(e.currency&&"all"!==e.currency?1:0)})]})}),c.advanced&&t.jsx("div",{className:"p-4 bg-white border-t border-slate-200",children:t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[t.jsx(se,{label:"PSP",children:t.jsxs(re,{value:e.psp,onValueChange:e=>x("psp",e),children:[t.jsx(ne,{variant:"default",size:"default",children:t.jsx(le,{placeholder:"All PSPs"})}),t.jsxs(ie,{children:[t.jsx(ce,{value:"all",children:"All PSPs"}),i.psps.map(e=>t.jsx(ce,{value:e,children:e},e))]})]})}),t.jsx(se,{label:"Company",children:t.jsxs(re,{value:e.company,onValueChange:e=>x("company",e),children:[t.jsx(ne,{variant:"default",size:"default",children:t.jsx(le,{placeholder:"All Companies"})}),t.jsxs(ie,{children:[t.jsx(ce,{value:"all",children:"All Companies"}),i.companies.map(e=>t.jsx(ce,{value:e,children:e},e))]})]})}),t.jsx(se,{label:"Payment Method",children:t.jsxs(re,{value:e.payment_method,onValueChange:e=>x("payment_method",e),children:[t.jsx(ne,{variant:"default",size:"default",children:t.jsx(le,{placeholder:"All Methods"})}),t.jsxs(ie,{children:[t.jsx(ce,{value:"all",children:"All Methods"}),i.payment_methods.map(e=>t.jsx(ce,{value:e,children:e},e))]})]})}),t.jsx(se,{label:"Currency",children:t.jsxs(re,{value:e.currency,onValueChange:e=>x("currency",e),children:[t.jsx(ne,{variant:"default",size:"default",children:t.jsx(le,{placeholder:"All Currencies"})}),t.jsxs(ie,{children:[t.jsx(ce,{value:"all",children:"All Currencies"}),i.currencies.map(e=>t.jsx(ce,{value:e,children:e},e))]})]})})]})})]}),t.jsxs("div",{className:"border border-slate-200 rounded-lg overflow-hidden",children:[t.jsx("div",{className:"flex items-center justify-between cursor-pointer bg-slate-50 p-3 hover:bg-slate-100 transition-colors",onClick:()=>h("amounts"),children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"transition-transform duration-200 "+(c.amounts?"rotate-180":""),children:t.jsx(r,{className:"h-4 w-4 text-slate-600"})}),t.jsx("h3",{className:"text-sm font-semibold text-slate-900",children:"Amount Filters"}),(e.amount_min||e.amount_max||e.commission_min||e.commission_max)&&t.jsx(V,{variant:"secondary",size:"sm",className:"bg-slate-900 text-white",children:(e.amount_min?1:0)+(e.amount_max?1:0)+(e.commission_min?1:0)+(e.commission_max?1:0)})]})}),c.amounts&&t.jsx("div",{className:"p-4 bg-white border-t border-slate-200",children:t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-sm font-medium text-slate-700",children:b("clients.min_amount")}),t.jsx(ae,{type:"number",placeholder:"0.00",value:e.amount_min,onChange:e=>x("amount_min",e.target.value)})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-sm font-medium text-slate-700",children:b("clients.max_amount")}),t.jsx(ae,{type:"number",placeholder:"1000000.00",value:e.amount_max,onChange:e=>x("amount_max",e.target.value)})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-sm font-medium text-slate-700",children:b("clients.min_commission")}),t.jsx(ae,{type:"number",placeholder:"0.00",value:e.commission_min,onChange:e=>x("commission_min",e.target.value)})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-sm font-medium text-slate-700",children:b("clients.max_commission")}),t.jsx(ae,{type:"number",placeholder:"10000.00",value:e.commission_max,onChange:e=>x("commission_max",e.target.value)})]})]})})]}),t.jsxs("div",{className:"border border-slate-200 rounded-lg overflow-hidden",children:[t.jsx("div",{className:"flex items-center justify-between cursor-pointer bg-slate-50 p-3 hover:bg-slate-100 transition-colors",onClick:()=>h("dates"),children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"transition-transform duration-200 "+(c.dates?"rotate-180":""),children:t.jsx(r,{className:"h-4 w-4 text-slate-600"})}),t.jsx("h3",{className:"text-sm font-semibold text-slate-900",children:"Date & Sorting"}),(e.date_from||e.date_to||"date"!==e.sort_by||"desc"!==e.sort_order)&&t.jsx(V,{variant:"secondary",size:"sm",className:"bg-slate-900 text-white",children:(e.date_from?1:0)+(e.date_to?1:0)+("date"!==e.sort_by?1:0)+("desc"!==e.sort_order?1:0)})]})}),c.dates&&t.jsx("div",{className:"p-4 bg-white border-t border-slate-200",children:t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[t.jsx(se,{label:"From Date",children:t.jsx(ae,{type:"date",variant:"default",size:"default",value:e.date_from,onChange:e=>x("date_from",e.target.value)})}),t.jsx(se,{label:"To Date",children:t.jsx(ae,{type:"date",variant:"default",size:"default",value:e.date_to,onChange:e=>x("date_to",e.target.value)})}),t.jsx(se,{label:"Sort By",children:t.jsxs(re,{value:e.sort_by,onValueChange:e=>x("sort_by",e),children:[t.jsx(ne,{variant:"default",size:"default",children:t.jsx(le,{placeholder:"Sort By"})}),t.jsxs(ie,{children:[t.jsx(ce,{value:"created_at",children:"Date Created"}),t.jsx(ce,{value:"amount",children:"Amount"}),t.jsx(ce,{value:"commission",children:"Commission"}),t.jsx(ce,{value:"client_name",children:"Client Name"}),t.jsx(ce,{value:"psp",children:"PSP"})]})]})}),t.jsx(se,{label:"Sort Order",children:t.jsxs(re,{value:e.sort_order,onValueChange:e=>x("sort_order",e),children:[t.jsx(ne,{variant:"default",size:"default",children:t.jsx(le,{placeholder:"Sort Order"})}),t.jsxs(ie,{children:[t.jsx(ce,{value:"desc",children:"Descending"}),t.jsx(ce,{value:"asc",children:"Ascending"})]})]})})]})})]}),f>0&&t.jsxs("div",{className:"bg-slate-50 border border-slate-200 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsx("h4",{className:"text-sm font-semibold text-slate-900",children:"Active Filters"}),t.jsx(V,{variant:"secondary",size:"sm",className:"bg-slate-900 text-white",children:f})]}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.search&&t.jsxs(V,{variant:"secondary",size:"sm",className:"bg-white border border-slate-300 text-slate-700",children:['Search: "',e.search,'"']}),e.category&&"all"!==e.category&&t.jsxs(V,{variant:"secondary",size:"sm",className:"bg-white border border-slate-300 text-slate-700",children:["Category: ",e.category]}),e.psp&&"all"!==e.psp&&t.jsxs(V,{variant:"secondary",size:"sm",className:"bg-white border border-slate-300 text-slate-700",children:["PSP: ",e.psp]}),e.company&&"all"!==e.company&&t.jsxs(V,{variant:"secondary",size:"sm",className:"bg-white border border-slate-300 text-slate-700",children:["Company: ",e.company]}),e.payment_method&&"all"!==e.payment_method&&t.jsxs(V,{variant:"secondary",size:"sm",className:"bg-white border border-slate-300 text-slate-700",children:["Method: ",e.payment_method]}),e.currency&&"all"!==e.currency&&t.jsxs(V,{variant:"secondary",size:"sm",className:"bg-white border border-slate-300 text-slate-700",children:["Currency: ",e.currency]}),e.status&&"all"!==e.status&&t.jsxs(V,{variant:"secondary",size:"sm",className:"bg-white border border-slate-300 text-slate-700",children:["Status: ",e.status]}),e.date_from&&t.jsxs(V,{variant:"secondary",size:"sm",className:"bg-white border border-slate-300 text-slate-700",children:["From: ",e.date_from]}),e.date_to&&t.jsxs(V,{variant:"secondary",size:"sm",className:"bg-white border border-slate-300 text-slate-700",children:["To: ",e.date_to]}),e.amount_min&&t.jsxs(V,{variant:"secondary",size:"sm",className:"bg-white border border-slate-300 text-slate-700",children:["Min: â‚º",e.amount_min]}),e.amount_max&&t.jsxs(V,{variant:"secondary",size:"sm",className:"bg-white border border-slate-300 text-slate-700",children:["Max: â‚º",e.amount_max]})]})]}),t.jsx("div",{className:"border-t border-slate-200 pt-4 mt-2",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"text-sm text-slate-600",children:f>0?t.jsxs("span",{children:[f," filter",1!==f?"s":""," applied Â· Showing ",Math.min(o,d)," of ",d," transactions"]}):t.jsxs("span",{children:["No filters applied Â· Showing ",Math.min(o,d)," transactions"]})}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs(Y,{variant:"outline",size:"sm",onClick:p,disabled:0===d,icon:t.jsx(n,{className:"h-4 w-4"}),iconPosition:"left",children:["Export Displayed (",Math.min(o,d),")"]}),t.jsx(Y,{variant:"outline",size:"sm",onClick:y,disabled:m,icon:m?t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-slate-600"}):t.jsx(n,{className:"h-4 w-4"}),iconPosition:"left",children:m?"Exporting...":"Export All"}),t.jsx(Y,{variant:"outline",size:"sm",onClick:u,disabled:0===f,icon:t.jsx(a,{className:"h-4 w-4"}),children:"Clear All"}),t.jsx(Y,{variant:"primary",size:"sm",onClick:g,icon:t.jsx(l,{className:"h-4 w-4"}),iconPosition:"left",children:"Apply Filters"})]})]})})]})})]})}function Te({transaction:e,onView:s,onEdit:a,onDelete:r,normalizePaymentMethodName:n=e=>e,onRowClick:l}){const x=i();return t.jsxs("tr",{className:"hover:scale-[1.02] transition-all duration-300 ease-in-out cursor-pointer "+("WD"===e.category?"bg-gray-100 hover:bg-gray-200":"bg-white hover:bg-gray-50"),onClick:t=>{const s=t.target;if(s.closest("button"))return;const a=s.closest("td");if(a){const e=a.closest("tr");if(e){const t=e.querySelectorAll("td"),s=t[t.length-1];if(s&&(s===a||s.contains(a)))return}}l?l(e):e.client_name&&x(`/clients/${encodeURIComponent(e.client_name)}`)},children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap border-b border-gray-100",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center mr-3 "+("WD"===e.category?"bg-gray-300":"bg-gray-100"),children:t.jsx(c,{className:"h-4 w-4 "+("WD"===e.category?"text-gray-700":"text-gray-600")})}),t.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.client_name||"Unknown"})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 border-b border-gray-100",children:e.company||"N/A"}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 border-b border-gray-100",children:n(e.payment_method||"N/A")}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 border-b border-gray-100",children:e.category||"N/A"}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-900 text-right border-b border-gray-100",children:q(e.amount||0,e.currency)}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-900 text-right border-b border-gray-100",children:q(e.commission||0,e.currency)}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-600 text-right border-b border-gray-100",children:q(e.net_amount||0,e.currency)}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 border-b border-gray-100",children:e.currency||"N/A"}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 border-b border-gray-100",children:e.psp||"N/A"}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center border-b border-gray-100","data-action-cell":"true",onClick:e=>e.stopPropagation(),children:t.jsxs("div",{className:"flex items-center justify-center gap-1",children:[t.jsx(oe,{onClick:t=>{t.stopPropagation(),s(e)},variant:"ghost",size:"icon-sm",className:"text-gray-600 hover:text-gray-900",title:"View Details",children:t.jsx(o,{className:"h-3 w-3"})}),t.jsx(oe,{onClick:t=>{t.stopPropagation(),a(e)},variant:"ghost",size:"icon-sm",className:"text-green-600 hover:text-green-900",title:"Edit Transaction",children:t.jsx(d,{className:"h-3 w-3"})}),t.jsx(oe,{onClick:t=>{t.stopPropagation(),r(e)},variant:"ghost",size:"icon-sm",className:"text-red-600 hover:text-red-900",title:"Delete Transaction",children:t.jsx(m,{className:"h-3 w-3"})})]})})]},e.id)}function Re(){const{t:r}=B(),{isAuthenticated:q,isLoading:se}=W(),re=i(),{refreshPSPDataSilent:ne}=(()=>{const t=e.useCallback(async()=>{try{K.clearCacheForUrl("psp_summary_stats");const e=await K.get("/transactions/psp_summary_stats");if(200===e.status)return K.parseResponse(e);throw new Error("Failed to fetch PSP data")}catch(Oe){throw Oe}},[]),s=e.useCallback(async()=>{try{await t()}catch(Oe){}},[t]);return{refreshPSPData:t,refreshPSPDataSilent:s}})(),le=e.useRef(!1),ie=e.useRef(!1),ce=e.useRef(0);e.useEffect(()=>{try{localStorage.removeItem("pipeline_clients_data"),localStorage.removeItem("pipeline_transactions_data"),localStorage.removeItem("pipeline_dashboard_cache")}catch(e){}},[]);const[ke,De]=e.useState([]),[Re,Pe]=e.useState([]),[Le,Fe]=e.useState(null),[Ue,$e]=e.useState(!1),[Oe,Ie]=e.useState(null),[Me,ze]=e.useState(null),[Be,We]=e.useState({clients:!1,transactions:!1,analytics:!1,dropdowns:!1,allLoaded:!1}),[Ke,He]=e.useState(null);e.useState([]);const[Ye,Ve]=e.useState(!1),[qe,Je]=e.useState(!1),[Ge,Xe]=e.useState(!1);e.useState(!1);const[Ze,Qe]=e.useState(""),[et,tt]=e.useState(!1);e.useState(new Set);const[st,at]=e.useState({});e.useState({});const[rt,nt]=e.useState(!1),[lt,it]=e.useState(null),[ct,ot]=e.useState(!1),[dt,mt]=e.useState(""),[xt,ht]=e.useState({}),[ut,gt]=e.useState(!1),[pt,yt]=e.useState(""),[jt,bt]=e.useState(""),[ft,_t]=e.useState(!1),[Nt,vt]=e.useState(!1),[wt,Ct]=e.useState(""),[St,kt]=e.useState(48.9);e.useEffect(()=>{(async()=>{try{const e=await K.get("/exchange-rates/current");if(e.ok){const t=await K.parseResponse(e);t&&t.rates&&t.rates.USD_TRY&&kt(t.rates.USD_TRY.rate)}}catch(e){}})()},[]);const[Dt,At]=e.useState({psps:[],categories:[],payment_methods:[],currencies:[],companies:[]}),[Et,Tt]=e.useState({search:"",category:"all",psp:"all",company:"all",payment_method:"all",currency:"all",status:"all",date_from:"",date_to:"",amount_min:"",amount_max:"",commission_min:"",commission_max:"",client_name:"",sort_by:"date",sort_order:"desc"}),[Rt,Pt]=e.useState(!1),[Lt,Ft]=e.useState({basic:!0,advanced:!1,amounts:!1,dates:!1}),[Ut,$t]=e.useState({currentOffset:0,itemsPerLoad:100,total:0,hasMore:!0,loading:!1,oldestDate:null}),[Ot,It]=e.useState(100),[Mt,zt]=e.useState(!1),Bt=x(),[Wt,Kt]=O("overview");e.useEffect(()=>{const e=new URLSearchParams(Bt.search),t=e.get("client")||e.get("client_name"),s="true"===e.get("show_details");if(t){const e=decodeURIComponent(t);if(Tt(t=>({...t,client_name:e})),s&&ke.length>0){const t=ke.find(t=>t.client_name.toLowerCase()===e.toLowerCase());if(t){He(t),Zt(!0);const e=new URLSearchParams(Bt.search);e.delete("show_details"),re(`/clients?${e.toString()}`,{replace:!0})}}}else Tt(e=>({...e,client_name:""}))},[Bt.search,ke,re]);const[Ht,Yt]=e.useState(!1),[Vt,qt]=e.useState(!1),[Jt,Gt]=e.useState(null),[Xt,Zt]=e.useState(!1),[Qt,es]=e.useState(!1);e.useState(!1);const[ts,ss]=e.useState(!1),[as,rs]=e.useState(!1),[ns,ls]=e.useState(null),[is,cs]=e.useState(!1),[os,ds]=e.useState(!1),[ms,xs]=e.useState(!1),[hs,us]=e.useState([]),[gs,ps]=e.useState([]),[ys,js]=e.useState(!1),[bs,fs]=e.useState(""),_s=e.useCallback(async()=>{if(!ie.current&&!le.current&&q&&!se){ie.current=!0,$e(!0),Ie(null);try{const[e,t,s]=await Promise.allSettled([vs(),ws(),Cs()]);We(a=>({...a,clients:"fulfilled"===e.status,dropdowns:"fulfilled"===t.status,transactions:"fulfilled"===s.status,allLoaded:!0})),"fulfilled"===e.status&&ze(null),"fulfilled"===s.status&&Ie(null),le.current=!0}catch(e){Ie("Failed to load data. Please try again.")}finally{ie.current=!1,$e(!1)}}},[q,se]);e.useEffect(()=>{const e=e=>{const t=e;t?.detail?.skipCurrentPage||q&&!se&&("create"===t?.detail?.action&&$t(e=>({...e,currentOffset:0,hasMore:!0,oldestDate:null})),Cs(!0),vs())};return window.addEventListener("transactionsUpdated",e),()=>{window.removeEventListener("transactionsUpdated",e)}},[q,se]),e.useEffect(()=>()=>{Jt&&clearTimeout(Jt)},[Jt]);const Ns=e.useCallback(async()=>{if(!Ue)try{$e(!0),Ie(null),$t(e=>({...e,currentOffset:0,hasMore:!0,oldestDate:null})),await Cs(!0,!1)}catch(e){const t=(e=>Ae.handleApiError(e,"fetchTransactions"))(e);Ie((e=>Ae.getUserFriendlyMessage(e))(t))}finally{$e(!1),qt(!1),Jt&&(clearTimeout(Jt),Gt(null))}},[Et,Ut.itemsPerLoad,Ue]);e.useEffect(()=>{Ht||"/transactions"===Bt.pathname&&(Kt("transactions"),q&&!se&&0===Re.length&&_s())},[Bt.pathname,q,se,Ht,_s]),e.useEffect(()=>{if(q&&!se)0===ke.length&&0===Re.length&&_s();else if(!q&&!se&&(ke.length>0||Re.length>0)){De([]),Pe([]),Ie(null);try{localStorage.removeItem("pipeline_clients_data"),localStorage.removeItem("pipeline_transactions_data")}catch(e){}}},[q,se,_s]),e.useEffect(()=>{},[Wt]),e.useEffect(()=>{"transactions"!==Wt||!q||se||0!==Re.length||Ue||Cs()},[Wt,q,se]),e.useEffect(()=>{try{const e=localStorage.getItem("clients_transactions_display_limit");if(e&&"transactions"===Wt){const t=parseInt(e,10);!isNaN(t)&&t>=100?It(t):It(100)}else It(100)}catch(e){It(100)}},[Bt.pathname,Wt]),e.useEffect(()=>{if("transactions"===Wt&&Ot>0)try{localStorage.setItem("clients_transactions_display_limit",Ot.toString())}catch(e){}},[Ot,Wt]);const vs=async()=>{try{if(Date.now()-ce.current<5e3)return[];if(ze(null),!q)return ze("Authentication required"),[];const e=await K.get(`/transactions/clients?_t=${Date.now()}&_refresh=${Math.random()}`);if(401===e.status)return[];if(e.ok){const t=await K.parseResponse(e);let s,a=null;t&&"object"==typeof t&&"clients"in t?(s=t.clients||[],a=t.summary||null):s=Array.isArray(t)?t:[];const r=s.map(e=>({client_name:e.client_name||"Unknown",company_name:e.company_name||null,payment_method:e.payment_method||null,category:e.category||null,total_amount:e.total_amount||0,total_commission:e.total_commission||0,total_net:e.total_net||0,transaction_count:e.transaction_count||0,first_transaction:e.first_transaction||"",last_transaction:e.last_transaction||"",currencies:e.currencies||[],psps:e.psps||[],avg_transaction:e.avg_transaction||0}));return De(r),Fe(a),ze(null),r}return ze("Failed to load clients data"),De([]),[]}catch(e){return ze("Failed to load clients data. Please try again."),De([]),[]}},ws=async()=>{try{const e=await K.get("/transactions/dropdown-options");if(e.ok){const t=await K.parseResponse(e);return t&&At({currencies:(t.currencies||t.currency||[]).map(e=>e.value),payment_methods:(t.payment_method||[]).map(e=>e.value),categories:(t.category||[]).map(e=>e.value),psps:(t.psp||[]).map(e=>e.value),companies:(t.company||[]).map(e=>e.value)}),t}return{}}catch(e){return{}}},Cs=async(e=!1,t=!1)=>{try{const a=Date.now();if(!e&&!t&&a-ce.current<5e3)return[];if(ce.current=a,!q)return[];if(Ue&&!e)return[];const r=new URLSearchParams;if(r.append("page","1"),r.append("per_page",Ut.itemsPerLoad.toString()),Et.search&&""!==Et.search.trim()&&r.append("search",Et.search),Et.category&&""!==Et.category.trim()&&"all"!==Et.category&&r.append("category",Et.category),Et.psp&&""!==Et.psp.trim()&&"all"!==Et.psp&&r.append("psp",Et.psp),Et.company&&""!==Et.company.trim()&&"all"!==Et.company&&r.append("company",Et.company),Et.payment_method&&""!==Et.payment_method.trim()&&"all"!==Et.payment_method&&r.append("payment_method",Et.payment_method),Et.currency&&""!==Et.currency.trim()&&"all"!==Et.currency&&r.append("currency",Et.currency),Et.status&&""!==Et.status.trim()&&"all"!==Et.status&&r.append("status",Et.status),Et.date_from&&""!==Et.date_from.trim()&&r.append("date_from",Et.date_from),t&&Ut.oldestDate){const e=new Date(Ut.oldestDate);e.setDate(e.getDate()-1),r.append("date_to",e.toISOString().split("T")[0])}else Et.date_to&&""!==Et.date_to.trim()&&r.append("date_to",Et.date_to);Et.amount_min&&""!==Et.amount_min.trim()&&r.append("amount_min",Et.amount_min),Et.amount_max&&""!==Et.amount_max.trim()&&r.append("amount_max",Et.amount_max),Et.commission_min&&""!==Et.commission_min.trim()&&r.append("commission_min",Et.commission_min),Et.commission_max&&""!==Et.commission_max.trim()&&r.append("commission_max",Et.commission_max),Et.client_name&&""!==Et.client_name.trim()&&r.append("client",Et.client_name),Et.sort_by&&""!==Et.sort_by.trim()&&r.append("sort_by",Et.sort_by),Et.sort_order&&""!==Et.sort_order.trim()&&r.append("sort_order",Et.sort_order);const n=await K.get(`/transactions/?${r.toString()}`);if(401===n.status)return Pe([]),Ie("Authentication required. Please log in again."),[];if(!n.ok){try{const e=await K.parseResponse(n),t=e?.message||e?.error||`Failed to fetch transactions: ${n.status} ${n.statusText}`;Ie(t)}catch(s){Ie(`Failed to fetch transactions: ${n.status} ${n.statusText}`)}return[]}const l=n.data;if(n.ok){const e=await K.parseResponse(n);let s=[];Array.isArray(e)?s=e:l?.data&&Array.isArray(l.data)?s=l.data:Array.isArray(e?.transactions)?s=e.transactions:Array.isArray(e?.meta?.transactions)&&(s=e.meta.transactions);const a=l?.meta?.pagination?.total||l?.meta?.total||e?.pagination?.total||e?.meta?.pagination?.total||0;if(s.length,s.length>0){const e=s.map(e=>e.date).filter(Boolean);e.length>0&&Math.min(...e.map(e=>new Date(e).getTime())),e.length>0&&Math.max(...e.map(e=>new Date(e).getTime()))}Pe(t?e=>{const t=new Set(e.map(e=>e.id)),a=s.filter(e=>!t.has(e.id)&&!(Ut.oldestDate&&e.date&&new Date(e.date).toISOString().split("T")[0]>=new Date(Ut.oldestDate).toISOString().split("T")[0]));return[...e,...a]}:s);let r=Ut.oldestDate;if(s.length>0){const e=s.map(e=>e.date||e.created_at).filter(e=>null!=e).sort();if(e.length>0){const t=e[0];(!r||t<r)&&(r=t)}}const i=a||0,c=t?Ut.currentOffset+s.length:s.length,o=s.length===Ut.itemsPerLoad,d=t?Ut.currentOffset+s.length:s.length,m=o||i>0&&!(i>0&&d>=i);return $t(e=>({...e,currentOffset:c,total:i,hasMore:m,oldestDate:r})),Ts(s),s}return[]}catch(a){return Ie(`Failed to load transactions: ${a instanceof Error?a.message:"Unknown error"}`),[]}},Ss=async()=>{$e(!0),await vs(),$e(!1)},ks=()=>Object.values(Et).filter(e=>e&&"created_at"!==e&&"desc"!==e).length,Ds=(e,t)=>X(e,t||"USD"),As=e=>{if(!e)return"N/A";const t=new Date(e),s=new Date,a=new Date(s);return a.setDate(a.getDate()-1),t.toDateString()===s.toDateString()?"Today":t.toDateString()===a.toDateString()?"Yesterday":t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},Es=e=>{const t=e.reduce((e,t)=>{const s=t.date||"Unknown";return e[s]||(e[s]=[]),e[s].push(t),e},{}),s=Object.entries(t).sort(([e],[t])=>t.localeCompare(e)).map(([e,t])=>({dateKey:e,date:e,transactions:t.sort((e,t)=>{const s=e.created_at?new Date(e.created_at).getTime():0;return(t.created_at?new Date(t.created_at).getTime():0)-s}),grossBalance:xt[e]||null}));return s.slice(0,3).forEach((e,t)=>{}),s},Ts=async e=>{const t=[...new Set(e.map(e=>e.date).filter(Boolean))],s={};if(0!==t.length){try{const e=t.join(","),r=await fetch(`/api/summary/batch?dates=${encodeURIComponent(e)}`,{credentials:"include",headers:{Accept:"application/json"}});if(r.ok){const e=await r.json();e&&e.success&&e.summaries&&Object.entries(e.summaries).forEach(([e,t])=>{if(t&&void 0!==t.gross_balance_tl){let a=Number(t.exchange_rate)||0;0!==a&&t.exchange_rate||(a=St||48),s[e]={tl:Number(t.gross_balance_tl)||0,usd:Number(t.gross_balance_usd)||0,rate:a}}})}else try{await r.json()}catch(a){}}catch(r){r instanceof Error&&r.message}ht(s)}else ht(s)},Rs=(e,t)=>{const s=e.map(e=>{const t=e=>{if(null==e)return"";const t=String(e);return t.includes(",")||t.includes('"')||t.includes("\n")?`"${t.replace(/"/g,'""')}"`:t},s=e.amount&&e.amount>0?((e.commission||0)/e.amount*100).toFixed(2):0;return[t(e.id),t(e.date),t(e.client_name||"Unknown"),t(e.payment_method||"-"),t(e.psp||"-"),t(e.amount_tl||e.amount||0),t(e.amount_usd||0),t(e.currency||"TRY"),t(e.transaction_type||e.category||"deposit"),t(s+"%"),t(e.commission_tl||e.commission||0),t(e.net_amount_tl||e.net_amount||0),t(e.notes||""),t(e.created_at)]}),a=[["ID","Date","Client Name","Payment Method","PSP","Amount (TRY)","Amount (USD)","Currency","Transaction Type","Commission Rate","Commission Amount","Net Amount","Description","Created At"].join(","),...s.map(e=>e.join(","))].join("\n"),r=new Blob(["\ufeff"+a],{type:"text/csv;charset=utf-8;"}),n=window.URL.createObjectURL(r),l=document.createElement("a");l.href=n,l.download=t,l.click(),window.URL.revokeObjectURL(n)},Ps=async()=>{zt(!0);try{const e=[],t=500;let s=1,a=!0,r=1;const n=new URLSearchParams;for(Et.search&&""!==Et.search.trim()&&n.append("search",Et.search),Et.client_name&&""!==Et.client_name.trim()&&"all"!==Et.client_name&&n.append("client_name",Et.client_name),Et.payment_method&&""!==Et.payment_method.trim()&&"all"!==Et.payment_method&&n.append("payment_method",Et.payment_method),Et.psp&&""!==Et.psp.trim()&&"all"!==Et.psp&&n.append("psp",Et.psp),Et.date_from&&""!==Et.date_from.trim()&&n.append("date_from",Et.date_from),Et.date_to&&""!==Et.date_to.trim()&&n.append("date_to",Et.date_to),Et.amount_min&&""!==Et.amount_min.trim()&&n.append("amount_min",Et.amount_min),Et.amount_max&&""!==Et.amount_max.trim()&&n.append("amount_max",Et.amount_max);a&&s<=r;){const l=new URLSearchParams(n);l.append("per_page",t.toString()),l.append("page",s.toString());const i=await K.get(`/transactions/?${l.toString()}`),c=await K.parseResponse(i),o=c.transactions||[];if(e.push(...o),c.pagination?(r=c.pagination.pages||1,a=s<r&&o.length===t):a=o.length===t,s++,s>100)break}const l=(new Date).toISOString().split("T")[0],i=`transactions_all_${e.length}_${l}.csv`;Rs(e,i)}catch(e){alert(r("transactions.export_failed"))}finally{zt(!1)}},Ls=async e=>{const t=e.target,s=t.files?.[0];if(!s)return;const a=s.name.split(".").pop()?.toLowerCase();if("xlsx"===a||"xls"===a){cs(!0);try{const e=new FormData;e.append("file",s);const t=["HAZIRAN","TEMMUZ","AÄžUSTOS","EKÄ°M","KASIM"];e.append("sheets",JSON.stringify(t));const a=await fetch("/api/v1/transactions/import-excel",{method:"POST",body:e,credentials:"include"});if(!a.ok){const e=await a.json();throw new Error(e.message||"Import failed")}const r=await a.json();let n="Excel Import Completed!\n\n";n+=`âœ… Imported: ${r.data.imported_count} transactions\n`,n+=`âš ï¸ Skipped: ${r.data.skipped_count} rows\n`,n+=`ðŸ“„ Sheets processed: ${r.data.sheets_processed}\n`,r.data.warnings&&r.data.warnings.length>0&&(n+=`\nâš ï¸ Warnings (${r.data.warnings.length}):\n`,r.data.warnings.slice(0,5).forEach(e=>n+=`â€¢ ${e}\n`),r.data.warnings.length>5&&(n+=`â€¢ ... and ${r.data.warnings.length-5} more\n`)),r.data.errors&&r.data.errors.length>0&&(n+=`\nâŒ Errors (${r.data.errors.length}):\n`,r.data.errors.slice(0,5).forEach(e=>n+=`â€¢ ${e}\n`)),alert(n),"transactions"===Wt&&await Ns(),await Ss(),await Js()}catch(r){alert(`Import Error: ${r.message}\n\nPlease check the file format and try again.`)}finally{cs(!1)}}else alert("Please upload an Excel file (.xlsx or .xls)")},Fs=e=>{ls(e),ss(!0)},Us=async e=>{try{await ws();const t=await K.get(`/transactions/${e.id}`);if(t.ok){const e=await K.parseResponse(t);ls(e.transaction||e),rs(!0)}else ls(e),rs(!0)}catch(t){ls(e),rs(!0)}},$s=async e=>{if(confirm(`${r("transactions.confirm_delete_transaction")}\n\n${r("transactions.client_name")}: ${e.client_name}\n${r("common.amount")}: ${Ds(e.amount,e.currency)}`))try{const s=await K.delete(`/transactions/${e.id}`);if(s.ok){const a=await K.parseResponse(s);if(a?.success){Pe(t=>t.filter(t=>t.id!==e.id)),$t(e=>({...e,total:e.total>0?e.total-1:0}));try{await ne()}catch(t){}window.dispatchEvent(new CustomEvent("transactionsUpdated",{detail:{action:"delete",transactionId:e.id}})),alert(r("transactions.transaction_deleted_success"))}else alert(a?.message||r("transactions.failed_delete_transaction"))}else{const e=await K.parseResponse(s);alert(e?.message||r("transactions.failed_delete_transaction"))}}catch(s){const e=s instanceof Error?s.message:"Unknown error";alert(`${r("transactions.delete_transaction_error")}: ${e}`)}},Os=()=>{Zt(!1),es(!1),Ve(!1),Xe(!1),He(null)},Is=Array.isArray(ke)?ke.filter(e=>{const t=!Et.search||e.client_name.toLowerCase().includes(Et.search.toLowerCase())||e.company_name&&e.company_name.toLowerCase().includes(Et.search.toLowerCase()),s=!Et.client_name||e.client_name.toLowerCase().includes(Et.client_name.toLowerCase()),a=!Et.payment_method||"all"===Et.payment_method||e.payment_method&&e.payment_method.toLowerCase().includes(Et.payment_method.toLowerCase()),r=!Et.category||"all"===Et.category||e.category&&e.category.toLowerCase().includes(Et.category.toLowerCase()),n=!Et.psp||"all"===Et.psp||Array.isArray(e.psps)&&e.psps.some(e=>e.toLowerCase().includes(Et.psp.toLowerCase())),l=!Et.currency||"all"===Et.currency||Array.isArray(e.currencies)&&e.currencies.some(e=>e.toLowerCase().includes(Et.currency.toLowerCase()));return t&&s&&a&&r&&n&&l}):[];Array.isArray(Is)&&Is.length>0?Is.reduce((e,t)=>e+t.total_amount,0):Array.isArray(ke)&&ke.length>0&&ke.reduce((e,t)=>e+t.total_amount,0);const Ms=Array.isArray(Is)&&Is.length>0?Is.reduce((e,t)=>e+t.total_commission,0):Array.isArray(ke)&&ke.length>0?ke.reduce((e,t)=>e+t.total_commission,0):0;Array.isArray(Is)&&Is.length>0?Is.reduce((e,t)=>e+t.transaction_count,0):Array.isArray(ke)&&ke.length>0&&ke.reduce((e,t)=>e+t.transaction_count,0);const[zs,Bs]=e.useState(null),[Ws,Ks]=e.useState(null),[Hs,Ys]=e.useState(0),Vs=e.useCallback(async()=>{try{const e=await K.get("/analytics/dashboard/stats?range=all");if(e.ok){const t=await K.parseResponse(e);Bs({total_revenue:t.summary?.total_revenue||0,total_commission:t.summary?.total_commission||0,net_cash:t.summary?.net_cash||0,total_deposits:t.summary?.total_deposits||0,total_withdrawals:t.summary?.total_withdrawals||0})}}catch(e){}},[]),qs=e=>{const t={KK:"Credit Card",BANKA:"Bank",Banka:"Bank",BANK:"Bank",CC:"Credit Card",CARD:"Credit Card","CREDIT CARD":"Credit Card",CASH:"Cash",WIRE:"Wire Transfer",TRANSFER:"Transfer",PAYPAL:"PayPal",STRIPE:"Stripe",SQUARE:"Square",TETHER:"Tether",USDT:"Tether",UNKNOWN:"Unknown"};if(t[e])return t[e];const s=e.toUpperCase();return t[s]?t[s]:s.includes("CREDIT")&&s.includes("CARD")?"Credit Card":s.includes("BANK")?"Bank":s.includes("TETHER")||s.includes("USDT")?"Tether":e},Js=e.useCallback(async()=>{try{const e=await K.get("/transactions/?per_page=500&page=1");if(200===e.status){const t=K.parseResponse(e),s=t&&t.transactions&&Array.isArray(t.transactions)?t.transactions:[],a={};s.forEach(e=>{const t=e.payment_method||"Unknown",s=qs(t);a[s]||(a[s]={deposits:0,withdrawals:0,total:0,count:0});const r=t.toLowerCase().includes("tether")||"TETHER"===t?e.amount||0:null!==e.amount_tl&&void 0!==e.amount_tl?e.amount_tl:e.amount||0;a[s].count+=1,"DEP"===e.category||"Deposit"===e.category||"Investment"===e.category?(a[s].deposits+=r,a[s].total+=r):"WD"!==e.category&&"Withdraw"!==e.category&&"Withdrawal"!==e.category||(a[s].withdrawals+=r,a[s].total-=r)}),Ks(a),Ys(s.length)}}catch(e){}},[]);e.useEffect(()=>{q&&!se&&(Vs(),Js())},[q,se]);const Gs=e.useMemo(()=>{if(zs)return{totalDeposits:zs.total_deposits,totalWithdrawals:zs.total_withdrawals};if(!Array.isArray(Re))return{totalDeposits:0,totalWithdrawals:0};const e=Re.filter(e=>"DEP"===e.category||"Deposit"===e.category||"Investment"===e.category),t=Re.filter(e=>"WD"===e.category||"Withdraw"===e.category||"Withdrawal"===e.category);return{totalDeposits:e.reduce((e,t)=>e+(null!==t.amount_tl&&void 0!==t.amount_tl?t.amount_tl:t.amount||0),0),totalWithdrawals:t.reduce((e,t)=>e+(null!==t.amount_tl&&void 0!==t.amount_tl?t.amount_tl:t.amount||0),0)}},[zs,Re]),{totalDeposits:Xs,totalWithdrawals:Zs}=Gs;e.useMemo(()=>{if(Ws&&Object.keys(Ws).length>0)return Ws;if(!Array.isArray(Re))return{};const e={};return Re.forEach(t=>{const s=t.payment_method||"Unknown",a=qs(s);e[a]||(e[a]={deposits:0,withdrawals:0,total:0,count:0});const r=s.toLowerCase().includes("tether")||"TETHER"===s?t.amount||0:null!==t.amount_tl&&void 0!==t.amount_tl?t.amount_tl:t.amount||0;e[a].count+=1,"DEP"===t.category||"Deposit"===t.category||"Investment"===t.category?(e[a].deposits+=r,e[a].total+=r):"WD"!==t.category&&"Withdraw"!==t.category&&"Withdrawal"!==t.category||(e[a].withdrawals+=r,e[a].total-=r)}),e},[Ws,Re]);const Qs=()=>{gt(!1),yt(""),bt("")},ea=async e=>{try{ot(!0),mt(e);const s=await fetch(`/api/summary/${e}`,{credentials:"include",headers:{"Content-Type":"application/json"}});if(s.ok){const e=await s.json(),t={...e,usd_rate:null!==e.usd_rate&&void 0!==e.usd_rate?"number"==typeof e.usd_rate?e.usd_rate:Number(e.usd_rate):null,gross_balance_tl:void 0!==e.gross_balance_tl?Number(e.gross_balance_tl):void 0,gross_balance_usd:void 0!==e.gross_balance_usd?Number(e.gross_balance_usd):void 0,total_deposits_tl:void 0!==e.total_deposits_tl?Number(e.total_deposits_tl):0,total_deposits_usd:void 0!==e.total_deposits_usd?Number(e.total_deposits_usd):0,total_withdrawals_tl:void 0!==e.total_withdrawals_tl?Number(e.total_withdrawals_tl):0,total_withdrawals_usd:void 0!==e.total_withdrawals_usd?Number(e.total_withdrawals_usd):0,payment_method_totals:e.payment_method_totals?{BANK:e.payment_method_totals.BANK?{amount_tl:Number(e.payment_method_totals.BANK.amount_tl||0),amount_usd:Number(e.payment_method_totals.BANK.amount_usd||0),count:Number(e.payment_method_totals.BANK.count||0)}:void 0,CC:e.payment_method_totals.CC?{amount_tl:Number(e.payment_method_totals.CC.amount_tl||0),amount_usd:Number(e.payment_method_totals.CC.amount_usd||0),count:Number(e.payment_method_totals.CC.count||0)}:void 0,TETHER:e.payment_method_totals.TETHER?{amount_tl:Number(e.payment_method_totals.TETHER.amount_tl||0),amount_usd:Number(e.payment_method_totals.TETHER.amount_usd||0),count:Number(e.payment_method_totals.TETHER.count||0)}:void 0}:void 0};it(t),nt(!0)}else{try{await s.json()}catch(t){}const a={date:e,date_str:new Date(e).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),usd_rate:null,total_amount_tl:0,total_amount_usd:0,total_commission_tl:0,total_commission_usd:0,total_net_tl:0,total_net_usd:0,transaction_count:0,unique_clients:0,psp_summary:[],category_summary:[],payment_method_summary:[],transactions:[]};it(a),nt(!0)}}catch(s){s instanceof Error&&s.message;const t={date:e,date_str:new Date(e).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),usd_rate:null,total_amount_tl:0,total_amount_usd:0,total_commission_tl:0,total_commission_usd:0,total_net_tl:0,total_net_usd:0,transaction_count:0,unique_clients:0,psp_summary:[],category_summary:[],payment_method_summary:[],transactions:[]};it(t),nt(!0)}finally{ot(!1)}},ta=()=>{const e=Re.reduce((e,t)=>{const s=t.payment_method||"Unknown",a=qs(s);return e[a]||(e[a]={method:a,volume:0,count:0}),e[a].volume+=Math.abs(t.amount),e[a].count+=1,e},{});return Object.values(e).sort((e,t)=>t.volume-e.volume).slice(0,5)},sa=["#3b82f6","#8b5cf6","#10b981","#f59e0b","#ef4444","#06b6d4"];if(se)return t.jsx(I,{});if(Oe&&!Me)return t.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-red-500 mb-4",children:t.jsx(h,{className:"h-16 w-16 mx-auto"})}),t.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Application Error"}),t.jsx("p",{className:"text-gray-600 mb-6",children:Oe}),t.jsxs(oe,{variant:"default",onClick:()=>window.location.reload(),className:"inline-flex items-center gap-2",children:[t.jsx(l,{className:"h-4 w-4"}),"Reload Page"]})]})});const aa=(e,t)=>{if("essential"===e)if("csv"===t){const e=new Blob(["Client,Company,Payment Method,Category,Amount,Currency,PSP,Date\nJohn Doe,ABC Corporation,Credit Card,DEP,1000.50,USD,Stripe,2025-08-18\nJane Smith,XYZ Ltd,Bank Transfer,WIT,2500.00,EUR,PayPal,2025-08-19\nMike Johnson,Global Inc,TR1122334455,Wire Transfer,DEP,5000.00,GBP,Bank of America,2025-08-20"],{type:"text/csv"}),t=window.URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download="essential_transaction_template.csv",s.click(),window.URL.revokeObjectURL(t)}else{const e=[["Client","Company","Payment Method","Category","Amount","Currency","PSP","Date"],["John Doe","ABC Corporation","Credit Card","DEP",1000.5,"USD","Stripe","2025-08-18"],["Jane Smith","XYZ Ltd","Bank Transfer","WIT",2500,"EUR","PayPal","2025-08-19"],["Mike Johnson","Global Inc","TR1122334455","Wire Transfer","DEP",5e3,"GBP","Bank of America","2025-08-20"]],t=U.aoa_to_sheet(e),s=U.book_new();U.book_append_sheet(s,t,"Transactions"),$(s,"essential_transaction_template.xlsx")}else if("csv"===t){const e=new Blob(["Client,Company,Payment Method,Category,Amount,Commission,Net Amount,Currency,PSP,Date,Notes\nJohn Doe,ABC Corporation,Credit Card,DEP,1000.50,25.00,975.50,USD,Stripe,2025-08-18,Monthly payment\nJane Smith,XYZ Ltd,Bank Transfer,WIT,2500.00,50.00,2450.00,EUR,PayPal,2025-08-19,Quarterly transfer\nMike Johnson,Global Inc,TR1122334455,Wire Transfer,DEP,5000.00,100.00,4900.00,GBP,Bank of America,2025-08-20,Annual deposit"],{type:"text/csv"}),t=window.URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download="full_transaction_template.csv",s.click(),window.URL.revokeObjectURL(t)}else{const e=[["Client","Company","Payment Method","Category","Amount","Commission","Net Amount","Currency","PSP","Date","Notes"],["John Doe","ABC Corporation","Credit Card","DEP",1000.5,25,975.5,"USD","Stripe","2025-08-18","Monthly payment"],["Jane Smith","XYZ Ltd","Bank Transfer","WIT",2500,50,2450,"EUR","PayPal","2025-08-19","Quarterly transfer"],["Mike Johnson","Global Inc","TR1122334455","Wire Transfer","DEP",5e3,100,4900,"GBP","Bank of America","2025-08-20","Annual deposit"]],t=U.aoa_to_sheet(e),s=U.book_new();U.book_append_sheet(s,t,"Transactions"),$(s,"full_transaction_template.xlsx")}};return Ue?t.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"}),t.jsx("p",{className:"mt-4 text-gray-600",children:"Loading clients..."})]})}):t.jsxs("div",{className:"p-6",children:[t.jsx("div",{className:"mb-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"space-y-1",children:[t.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[t.jsx(u,{className:"h-8 w-8 text-gray-600"}),r("clients.title")]}),t.jsx("p",{className:"text-gray-600",children:r("clients.description")})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(Y,{variant:"outline",size:"sm",onClick:Ps,disabled:Mt,icon:Mt?t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-600"}):t.jsx(n,{className:"h-4 w-4"}),iconPosition:"left",className:"bg-gray-50 border-gray-300 text-gray-700 hover:bg-gray-100",children:r(Mt?"common.loading":"clients.export_all_transactions")}),t.jsx(Y,{variant:"outline",size:"sm",onClick:()=>{const e=document.createElement("input");e.type="file",e.accept=".xlsx,.xls",e.onchange=Ls,e.click()},disabled:is,icon:t.jsx(g,{className:"h-4 w-4"}),iconPosition:"left",className:"bg-gray-50 border-gray-300 text-gray-700 hover:bg-gray-100",children:r(is?"common.loading":"clients.import")}),t.jsx(Y,{variant:"outline",size:"sm",onClick:()=>js(!0),disabled:is,icon:t.jsx(p,{className:"h-4 w-4"}),iconPosition:"left",className:"bg-gray-50 border-gray-300 text-gray-700 hover:bg-gray-100",children:r("clients_page.paste_import")}),t.jsx(Y,{variant:"outline",size:"sm",onClick:()=>ds(!0),icon:t.jsx(y,{className:"h-4 w-4"}),iconPosition:"left",className:"bg-gray-50 border-gray-300 text-gray-700 hover:bg-gray-100",children:r("clients.guide")}),t.jsx(Y,{variant:"outline",size:"sm",onClick:()=>Xe(!0),icon:t.jsx(m,{className:"h-4 w-4"}),iconPosition:"left",className:"bg-gray-50 border-gray-300 text-gray-700 hover:bg-gray-100",children:r("clients.bulk")}),t.jsx(Y,{variant:"outline",size:"sm",onClick:()=>{},icon:t.jsx(j,{className:"h-4 w-4"}),iconPosition:"left",className:"bg-gray-50 border-gray-300 text-gray-500 cursor-not-allowed opacity-60",disabled:!0,children:r("clients.brate")}),t.jsx(Y,{variant:"outline",size:"sm",onClick:async()=>{try{await Ss(),await Ns(),await(async()=>{try{K.clearCacheForUrl("psp_summary_stats");const e=await K.get("/transactions/psp_summary_stats");if(200===e.status)return K.parseResponse(e);throw new Error("Failed to fetch PSP data")}catch(e){throw e}})(),alert(r("transactions.data_refreshed"))}catch(e){const t=e instanceof Error?e.message:"Unknown error";alert(`${r("transactions.error_refreshing_data")}: ${t}`)}},icon:t.jsx(l,{className:"h-4 w-4"}),iconPosition:"left",className:"bg-gray-50 border-gray-300 text-gray-700 hover:bg-gray-100",children:r("clients.fetch")}),t.jsx(Y,{variant:"outline",size:"sm",onClick:()=>re("/transactions/add"),icon:t.jsx(b,{className:"h-4 w-4"}),iconPosition:"left",className:"bg-gray-50 border-gray-300 text-gray-700 hover:bg-gray-100",children:r("clients.add_transaction")})]})]})}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs(de,{value:Wt,onValueChange:e=>{const t=e;Kt(e),"transactions"===Wt&&"transactions"!==t&&It(100)},className:"w-full",children:[t.jsxs(me,{className:"grid w-full grid-cols-4 bg-gray-50/80 border border-gray-200/60 rounded-lg shadow-sm",children:[t.jsxs(xe,{value:"overview",className:"group flex items-center gap-2 transition-all duration-300 ease-in-out hover:bg-white/90 hover:shadow-md hover:scale-[1.02] data-[state=active]:bg-white data-[state=active]:shadow-lg data-[state=active]:border data-[state=active]:border-gray-200",children:[t.jsx(f,{className:"h-4 w-4 transition-all duration-300 ease-in-out group-hover:scale-110 group-hover:text-gray-700"}),t.jsx("span",{className:"transition-all duration-300 ease-in-out group-hover:font-semibold",children:r("tabs.overview")})]}),t.jsxs(xe,{value:"clients",className:"group flex items-center gap-2 transition-all duration-300 ease-in-out hover:bg-white/90 hover:shadow-md hover:scale-[1.02] data-[state=active]:bg-white data-[state=active]:shadow-lg data-[state=active]:border data-[state=active]:border-gray-200",children:[t.jsx(u,{className:"h-4 w-4 transition-all duration-300 ease-in-out group-hover:scale-110 group-hover:text-gray-700"}),t.jsx("span",{className:"transition-all duration-300 ease-in-out group-hover:font-semibold",children:r("navigation.clients")})]}),t.jsxs(xe,{value:"transactions",className:"group flex items-center gap-2 transition-all duration-300 ease-in-out hover:bg-white/90 hover:shadow-md hover:scale-[1.02] data-[state=active]:bg-white data-[state=active]:shadow-lg data-[state=active]:border data-[state=active]:border-gray-200",children:[t.jsx(p,{className:"h-4 w-4 transition-all duration-300 ease-in-out group-hover:scale-110 group-hover:text-gray-700"}),t.jsx("span",{className:"transition-all duration-300 ease-in-out group-hover:font-semibold",children:r("navigation.transactions")})]}),t.jsxs(xe,{value:"analytics",className:"group flex items-center gap-2 transition-all duration-300 ease-in-out hover:bg-white/90 hover:shadow-md hover:scale-[1.02] data-[state=active]:bg-white data-[state=active]:shadow-lg data-[state=active]:border data-[state=active]:border-gray-200",children:[t.jsx(_,{className:"h-4 w-4 transition-all duration-300 ease-in-out group-hover:scale-110 group-hover:text-gray-700"}),t.jsx("span",{className:"transition-all duration-300 ease-in-out group-hover:font-semibold",children:r("tabs.analytics")})]})]}),t.jsxs(he,{value:"overview",className:"mt-6",children:[t.jsxs("div",{className:"mb-6",children:[t.jsxs("div",{className:"mb-4",children:[t.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[t.jsx(f,{className:"h-5 w-5 text-gray-600"}),r("clients.financial_overview")]}),t.jsx("p",{className:"text-sm text-gray-600 mt-1",children:r("clients.key_financial_metrics")})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[t.jsx(M,{title:r("ledger.total_deposits"),value:Ds(zs?.total_deposits||Xs,"â‚º"),subtitle:r("clients.all_dep_transactions"),icon:j,color:"green",animated:!0,animationDuration:500,showGlass:!0}),t.jsx(M,{title:r("ledger.total_withdrawals"),value:Ds(Math.abs(zs?.total_withdrawals||Zs),"â‚º"),subtitle:r("clients.all_wd_transactions"),icon:N,color:"red",animated:!0,animationDuration:500,showGlass:!0}),t.jsx(M,{title:r("dashboard.net_cash"),value:Ds((zs?.total_deposits||Xs)-(zs?.total_withdrawals||Zs),"â‚º"),subtitle:r("clients.all_transactions_net"),icon:v,color:(zs?.total_deposits||Xs)-(zs?.total_withdrawals||Zs)>=0?"gray":"red",animated:!0,animationDuration:500}),t.jsx(M,{title:r("dashboard.total_commissions"),value:Ds(zs?.total_commission||Ms,"â‚º"),subtitle:r("clients.all_transactions_commission"),icon:p,color:"purple",animated:!0,animationDuration:500})]})]}),t.jsxs("div",{className:"mb-6",children:[t.jsxs("div",{className:"mb-4",children:[t.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[t.jsx(u,{className:"h-5 w-5 text-gray-600"}),r("clients.client_insights")]}),t.jsx("p",{className:"text-sm text-gray-600 mt-1",children:r("clients.distribution_top_performers")})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs(H,{variant:"elevated",className:"relative overflow-hidden",children:[t.jsx("div",{className:"absolute top-4 right-4 w-20 h-20 bg-gray-100 rounded-full opacity-20"}),t.jsx(te,{className:"p-6 relative",children:t.jsxs("div",{className:"flex items-start gap-4",children:[t.jsx("div",{className:"bg-gray-100 p-3 rounded-lg",children:t.jsx(u,{className:"h-6 w-6 text-gray-700"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"text-sm font-medium text-gray-600 mb-2",children:"Client Distribution"}),t.jsx("div",{className:"text-4xl font-bold text-gray-900 mb-2",children:Le?.total_clients||ke.length}),t.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:[Le?.multi_currency_count||ke.filter(e=>Array.isArray(e.currencies)&&e.currencies.length>1).length," multi-currency"]}),t.jsxs("div",{className:"space-y-2 pt-3 border-t border-gray-100",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("span",{className:"text-xs text-gray-600 flex items-center gap-1",children:[t.jsx(j,{className:"h-3 w-3"}),"New This Month"]}),t.jsxs("span",{className:"text-sm font-semibold text-emerald-600",children:["+",Le?.new_clients_this_month||0]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("span",{className:"text-xs text-gray-600 flex items-center gap-1",children:[t.jsx(v,{className:"h-3 w-3"}),"Avg Transaction"]}),t.jsx("span",{className:"text-sm font-semibold text-gray-700",children:Ds(Le?.avg_transaction_value||0,"â‚º")})]})]})]})]})})]}),t.jsxs(H,{variant:"elevated",className:"relative overflow-hidden",children:[t.jsx("div",{className:"absolute top-4 right-4 w-20 h-20 bg-purple-100 rounded-full opacity-20"}),t.jsx(te,{className:"p-6 relative",children:t.jsxs("div",{className:"flex items-start gap-4",children:[t.jsx("div",{className:"bg-purple-100 p-3 rounded-lg",children:t.jsx(w,{className:"h-6 w-6 text-purple-700"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"text-sm font-medium text-gray-600 mb-2",children:"Top Performers"}),t.jsx("div",{className:"text-2xl font-bold text-gray-900 mb-1 truncate",children:Le?.most_active?.client_name||(ke.length>0?ke.reduce((e,t)=>t.transaction_count>e.transaction_count?t:e).client_name:"N/A")}),t.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:["Most transactions: ",Le?.most_active?.transaction_count||(ke.length>0?ke.reduce((e,t)=>t.transaction_count>e.transaction_count?t:e).transaction_count:0)," txns"]}),t.jsxs("div",{className:"space-y-2 pt-3 border-t border-gray-100",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex flex-col",children:[t.jsxs("span",{className:"text-xs text-gray-600 flex items-center gap-1",children:[t.jsx(j,{className:"h-3 w-3"}),"Top by Volume"]}),t.jsx("span",{className:"text-xs font-medium text-gray-800 mt-0.5 truncate max-w-[120px]",children:Le?.top_by_volume?.client_name||"N/A"})]}),t.jsx("span",{className:"text-sm font-semibold text-emerald-600",children:Ds(Le?.top_by_volume?.total_amount||0,"â‚º")})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex flex-col",children:[t.jsxs("span",{className:"text-xs text-gray-600 flex items-center gap-1",children:[t.jsx(C,{className:"h-3 w-3"}),"Highest Commission"]}),t.jsx("span",{className:"text-xs font-medium text-gray-800 mt-0.5 truncate max-w-[120px]",children:Le?.top_by_commission?.client_name||"N/A"})]}),t.jsx("span",{className:"text-sm font-semibold text-purple-600",children:Ds(Le?.top_by_commission?.total_commission||0,"â‚º")})]})]})]})]})})]})]})]})]}),t.jsx(he,{value:"transactions",className:"mt-6",children:t.jsxs(H,{children:[t.jsx(Z,{children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"flex items-center gap-3",children:t.jsxs("div",{children:[t.jsxs(Q,{className:"flex items-center gap-3",children:["Transaction Management",t.jsx(V,{variant:"secondary",size:"sm",className:"bg-gray-100 text-gray-800",children:"Enhanced Filters Available"})]}),t.jsx(ee,{children:"All transaction records"})]})}),t.jsx("div",{className:"flex items-center gap-3",children:t.jsx(Y,{variant:Rt?"primary":"outline",onClick:()=>Pt(!Rt),icon:t.jsx(s,{className:"h-4 w-4"}),className:"transition-all duration-200 "+(Rt?"bg-gray-600 hover:bg-gray-700 text-white shadow-lg":"border-gray-300 text-gray-600 hover:bg-gray-50 hover:border-gray-400"),children:Rt?"Hide Filters":"Show Filters"+(ks()>0?` (${ks()})`:"")})})]})}),t.jsxs(te,{children:[Rt&&t.jsx("div",{className:"mb-6 animate-in slide-in-from-top-4 duration-300",children:t.jsx(Ee,{filters:Et,dropdownOptions:Dt,expandedFilterSections:Lt,displayLimit:Ot,transactionsLength:Re.length,exporting:Mt,onFilterChange:(e,t)=>{Tt(s=>({...s,[e]:t}))},onToggleFilterSection:e=>{Ft(t=>({...t,[e]:!t[e]}))},onClearAllFilters:()=>{Tt({search:"",category:"",psp:"",company:"",payment_method:"",currency:"",status:"",date_from:"",date_to:"",amount_min:"",amount_max:"",commission_min:"",commission_max:"",client_name:"",sort_by:"date",sort_order:"desc"}),$t(e=>({...e,currentOffset:0,hasMore:!0,oldestDate:null}))},onApplyFilters:()=>{$t(e=>({...e,currentOffset:0,hasMore:!0,oldestDate:null})),Ns()},onExportDisplayed:()=>{const e=Re.slice(0,Ot),t=(new Date).toISOString().split("T")[0],s=`transactions_displayed_${e.length}_${t}.csv`;Rs(e,s)},onExportAll:Ps,onApplyQuickFilter:e=>{switch(e){case"today":const e=(new Date).toISOString().split("T")[0];Tt(t=>({...t,date_from:e,date_to:e}));break;case"thisWeek":const t=new Date;t.setDate(t.getDate()-t.getDay());const s=new Date;s.setDate(s.getDate()+(6-s.getDay())),Tt(e=>({...e,date_from:t.toISOString().split("T")[0],date_to:s.toISOString().split("T")[0]}));break;case"deposits":Tt(e=>({...e,category:"DEP"}));break;case"withdrawals":Tt(e=>({...e,category:"WD"}));break;case"highValue":Tt(e=>({...e,amount_min:"10000"}))}$t(e=>({...e,currentOffset:0,hasMore:!0,oldestDate:null})),setTimeout(()=>{Ns()},100)}})}),Ue?t.jsxs("div",{className:"p-12 text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-600 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600 text-lg",children:"Loading transactions..."})]}):Oe?t.jsxs("div",{className:"p-12 text-center",children:[t.jsx("div",{className:"text-red-500 mb-4",children:t.jsx(h,{className:"h-16 w-16 mx-auto"})}),t.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Error Loading Transactions"}),t.jsx("p",{className:"text-gray-600 mb-6",children:Oe}),t.jsx(oe,{variant:"default",onClick:Ns,className:"flex items-center gap-2",children:"Try Again"})]}):0===Re.length?t.jsxs("div",{className:"p-12 text-center",children:[t.jsx("div",{className:"text-gray-400 mb-4",children:t.jsx(p,{className:"h-16 w-16 mx-auto"})}),t.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No Transactions Found"}),t.jsx("p",{className:"text-gray-600",children:"No transactions are currently available."})]}):t.jsxs("div",{className:"overflow-x-auto",children:[(()=>{const e=Es(Re);let s=[];e.forEach(e=>{s=[...s,...e.transactions]});const a=s.slice(0,Ot),r=Es(a);return 0===r.length?t.jsx("div",{className:"p-8 text-center text-gray-500",children:"No transactions to group by date"}):r.map((e,s)=>t.jsxs("div",{className:"border-b border-gray-100 last:border-b-0",children:[t.jsx("div",{className:"px-6 py-4 bg-white border-b border-gray-200",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-6",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("h4",{className:"text-base font-semibold text-gray-900",children:As(e.date)}),t.jsx("span",{className:"text-xs text-gray-500 font-normal",children:new Date(e.date).toLocaleDateString("en-US",{weekday:"short"})})]}),t.jsx("div",{className:"h-4 w-px bg-gray-300"}),t.jsxs("div",{className:"text-sm text-gray-700",children:[t.jsx("span",{className:"font-medium text-gray-900",children:e.transactions.length}),t.jsx("span",{className:"text-gray-600 ml-1",children:"transactions"})]}),t.jsx("div",{className:"h-4 w-px bg-gray-300"}),t.jsx("div",{className:"flex items-center gap-4 text-sm tabular-nums",children:e.grossBalance&&void 0!==e.grossBalance.tl?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("span",{className:"text-gray-600 text-xs",children:"TRY"}),t.jsx("span",{className:"font-semibold text-gray-900",children:Ds(e.grossBalance.tl,"â‚º")})]}),t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("span",{className:"text-gray-600 text-xs",children:"USD"}),t.jsx("span",{className:"font-semibold text-gray-900",children:Ds(e.grossBalance.usd,"$")})]}),e.grossBalance.rate>0&&t.jsxs("span",{className:"text-xs text-gray-500",children:["@",e.grossBalance.rate.toFixed(2)]})]}):(()=>{let s=0,a=0;e.transactions.forEach(e=>{const t=e.amount||0,r=e.category&&"WD"===e.category.toUpperCase()?-Math.abs(t):t;"TRY"===e.currency||"TL"===e.currency?s+=r:"USD"===e.currency&&(a+=r)});const r=s/St+a,n=r*St;return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("span",{className:"text-gray-600 text-xs",children:"TRY"}),t.jsx("span",{className:"font-semibold text-gray-900",children:Ds(n,"â‚º")})]}),t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("span",{className:"text-gray-600 text-xs",children:"USD"}),t.jsx("span",{className:"font-semibold text-gray-900",children:Ds(r,"$")})]}),t.jsxs("span",{className:"text-xs text-gray-500",children:["@",St.toFixed(2)]})]})})()})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(oe,{onClick:()=>ea(e.date),disabled:ct,variant:"ghost",size:"sm",className:"h-8 px-3 text-xs text-gray-700 hover:text-gray-900 hover:bg-gray-100",children:ct&&dt===e.date?"Loading...":"Summary"}),e.grossBalance&&e.grossBalance.rate>0||e.transactions&&e.transactions.length>0&&e.transactions.some(e=>"USD"===e.currency||"EUR"===e.currency)?t.jsx(oe,{onClick:()=>{return t=e.date,s=e.grossBalance?.rate||St||48,yt(t),bt(s.toString()),void gt(!0);var t,s},variant:"ghost",size:"sm",className:"h-8 px-3 text-xs text-gray-700 hover:text-gray-900 hover:bg-gray-100",title:`Edit exchange rate for ${e.date}`,children:"Edit Rate"}):null]})]})}),t.jsx("div",{className:"overflow-x-auto border border-gray-200 rounded-lg bg-white shadow-sm",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",style:{borderCollapse:"separate",borderSpacing:0},children:[t.jsx("thead",{className:"bg-gray-50 sticky top-0 z-10 shadow-sm",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider w-1/12 border-b border-gray-200",children:"Client"}),t.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider w-1/12 border-b border-gray-200",children:"Company"}),t.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider w-1/12 border-b border-gray-200",children:"Payment Method"}),t.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider w-1/12 border-b border-gray-200",children:"Category"}),t.jsx("th",{className:"px-6 py-4 text-right text-xs font-semibold text-gray-700 uppercase tracking-wider w-1/12 border-b border-gray-200 tabular-nums",children:"Amount"}),t.jsx("th",{className:"px-6 py-4 text-right text-xs font-semibold text-gray-700 uppercase tracking-wider w-1/12 border-b border-gray-200 tabular-nums",children:"Commission"}),t.jsx("th",{className:"px-6 py-4 text-right text-xs font-semibold text-gray-700 uppercase tracking-wider w-1/12 border-b border-gray-200 tabular-nums",children:"Net Amount"}),t.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider w-1/12 border-b border-gray-200",children:"Currency"}),t.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider w-1/12 border-b border-gray-200",children:"PSP"}),t.jsx("th",{className:"px-6 py-4 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider w-1/12 border-b border-gray-200",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:e.transactions.map(e=>t.jsx(Te,{transaction:e,onView:Fs,onEdit:Us,onDelete:$s,normalizePaymentMethodName:qs},e.id))})]})})]},e.dateKey))})(),t.jsx("div",{className:"px-6 py-4 border-t border-gray-200 bg-gray-50",children:t.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-700",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs("span",{className:"font-medium",children:[Re.length," ",r("dashboard.total_transactions").toLowerCase()]}),t.jsxs("span",{className:"text-gray-500",children:["across ",Es(Re).length," date",1!==Es(Re).length?"s":""]})]}),t.jsxs("span",{className:"font-semibold text-gray-900",children:["Total: ",Ds(Re.reduce((e,t)=>e+(t.amount||0),0),"TL")]})]})}),t.jsxs("div",{className:"border-t border-gray-200 bg-gradient-to-b from-white to-gray-50",children:[t.jsx("div",{className:"px-6 py-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-6",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(p,{className:"h-4 w-4 text-gray-500"}),t.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["Showing ",Re.length.toLocaleString()," ",1===Re.length?"transaction":"transactions"]})]}),Ut.total>0&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(S,{className:"h-4 w-4 text-blue-500"}),t.jsxs("span",{className:"text-sm text-gray-600",children:["Total: ",t.jsx("span",{className:"font-semibold text-gray-900",children:Ut.total.toLocaleString()})]})]}),Ut.oldestDate&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(k,{className:"h-4 w-4 text-purple-500"}),t.jsxs("span",{className:"text-sm text-gray-600",children:["Oldest: ",t.jsx("span",{className:"font-semibold text-gray-900",children:new Date(Ut.oldestDate).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]})]})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("div",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded",children:["Displaying: ",Math.min(Ot,Re.length),"/",Re.length," | hasMore: ",Ut.hasMore?"true":"false"," | Total: ",Ut.total]}),Ot<Re.length&&t.jsxs("div",{className:"flex items-center gap-2 bg-blue-50 px-3 py-1.5 rounded-lg",children:[t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("div",{className:"h-2 w-2 rounded-full bg-blue-500"}),t.jsxs("span",{className:"text-xs font-medium text-blue-700",children:[Math.round(Ot/Re.length*100),"% displayed"]})]}),t.jsx("div",{className:"w-24 h-1.5 bg-blue-100 rounded-full overflow-hidden",children:t.jsx("div",{className:"h-full bg-blue-500 rounded-full transition-all duration-300",style:{width:`${Math.min(Ot/Re.length*100,100)}%`}})})]})]})]})}),(()=>{const e=Ot<Re.length,t=Ut.hasMore;return e||t})()&&t.jsx("div",{className:"flex justify-center pb-6 px-6",children:t.jsx(Y,{variant:"outline",size:"lg",onClick:async()=>{if(Ut.loading)return;const e=Ot+100;if(It(e),e>=Re.length&&Ut.hasMore){$t(e=>({...e,loading:!0}));try{await Cs(!1,!0)}catch(t){}finally{$t(e=>({...e,loading:!1}))}}},disabled:Ut.loading,icon:Ut.loading?t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}):t.jsx(l,{className:"h-4 w-4"}),iconPosition:"left",className:"min-w-[280px] border-blue-200 text-blue-700 hover:bg-blue-50 hover:border-blue-300 transition-all duration-200 shadow-sm hover:shadow-md",children:Ut.loading?t.jsx("span",{children:"Loading older transactions..."}):t.jsxs("span",{children:["Load ",Ut.itemsPerLoad," More Transactions"]})})}),!Ut.hasMore&&Re.length>0&&t.jsx("div",{className:"flex justify-center pb-6 px-6",children:t.jsxs("div",{className:"flex items-center gap-3 bg-green-50 border border-green-200 text-green-700 px-6 py-3 rounded-lg shadow-sm",children:[t.jsx(D,{className:"h-5 w-5"}),t.jsxs("span",{className:"font-medium",children:["All transactions loaded (",Re.length.toLocaleString()," total)"]})]})})]})]})]})]})}),t.jsxs(he,{value:"analytics",className:"mt-6",children:[t.jsx("div",{className:"mb-8",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Analytics Dashboard"}),t.jsx("p",{className:"text-gray-600 mt-1",children:"Comprehensive insights and performance metrics"})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-gray-100 rounded-lg",children:[t.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),t.jsx("span",{className:"text-sm text-gray-700",children:"Live Data"})]}),t.jsxs(oe,{variant:"outline",size:"sm",children:[t.jsx(n,{className:"h-4 w-4 mr-2"}),"Export Report"]})]})]})}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[t.jsx(H,{className:"hover:shadow-lg transition-all duration-300",children:t.jsx(te,{className:"p-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-gray-600",children:r("clients.total_revenue")}),t.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:Ds(ke.reduce((e,t)=>e+t.total_amount,0),"â‚º")}),t.jsxs("p",{className:"text-sm text-green-600 mt-1 flex items-center",children:[t.jsx(j,{className:"h-4 w-4 mr-1"}),"+12.5% from last month"]})]}),t.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center",children:t.jsx(v,{className:"h-6 w-6 text-green-600"})})]})})}),t.jsx(H,{className:"hover:shadow-lg transition-all duration-300",children:t.jsx(te,{className:"p-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-gray-600",children:r("clients.active_clients")}),t.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:ke.filter(e=>e.transaction_count>0).length}),t.jsxs("p",{className:"text-sm text-blue-600 mt-1 flex items-center",children:[t.jsx(u,{className:"h-4 w-4 mr-1"}),ke.length," total clients"]})]}),t.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center",children:t.jsx(u,{className:"h-6 w-6 text-blue-600"})})]})})}),t.jsx(H,{className:"hover:shadow-lg transition-all duration-300",children:t.jsx(te,{className:"p-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-gray-600",children:r("clients.avg_transaction")}),t.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:Ds(ke.reduce((e,t)=>e+t.total_amount,0)/ke.reduce((e,t)=>e+t.transaction_count,0)||0,"â‚º")}),t.jsxs("p",{className:"text-sm text-purple-600 mt-1 flex items-center",children:[t.jsx(f,{className:"h-4 w-4 mr-1"}),"Per transaction"]})]}),t.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center",children:t.jsx(f,{className:"h-6 w-6 text-purple-600"})})]})})}),t.jsx(H,{className:"hover:shadow-lg transition-all duration-300",children:t.jsx(te,{className:"p-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-gray-600",children:r("clients.commission")}),t.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:Ds(ke.reduce((e,t)=>e+t.total_commission,0),"â‚º")}),t.jsxs("p",{className:"text-sm text-orange-600 mt-1 flex items-center",children:[t.jsx(A,{className:"h-4 w-4 mr-1"}),"8.5% avg rate"]})]}),t.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-xl flex items-center justify-center",children:t.jsx(A,{className:"h-6 w-6 text-orange-600"})})]})})})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8",children:[t.jsxs(H,{children:[t.jsxs(Z,{children:[t.jsxs(Q,{className:"flex items-center gap-2",children:[t.jsx(_,{className:"h-5 w-5 text-blue-600"}),r("clients_page.transaction_volume_trend")]}),t.jsx(ee,{children:r("clients_page.monthly_deposits_withdrawals")})]}),t.jsxs(te,{children:[t.jsx("div",{className:"h-80",children:t.jsx(ue,{width:"100%",height:"100%",children:t.jsxs(ge,{data:(()=>{const e=Re.reduce((e,t)=>{if(!t.date)return e;const s=new Date(t.date),a=`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}`;return e[a]||(e[a]={month:a,deposits:0,withdrawals:0,net:0,count:0}),t.amount>0?e[a].deposits+=t.amount:e[a].withdrawals+=Math.abs(t.amount),e[a].net+=t.amount,e[a].count+=1,e},{});return Object.values(e).sort((e,t)=>e.month.localeCompare(t.month)).slice(-6)})(),children:[t.jsx(pe,{strokeDasharray:"3 3",stroke:"#f3f4f6"}),t.jsx(ye,{dataKey:"month",stroke:"#6b7280",fontSize:12,tickFormatter:e=>{const[t,s]=e.split("-");return`${s}/${t.slice(2)}`}}),t.jsx(je,{stroke:"#6b7280",fontSize:12,tickFormatter:e=>Ds(e,"â‚º")}),t.jsx(be,{formatter:e=>[Ds(e,"â‚º"),""],labelFormatter:e=>{const[t,s]=e.split("-");return`${s}/${t}`},contentStyle:{backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)"}}),t.jsx(fe,{type:"monotone",dataKey:"deposits",stroke:"#10b981",strokeWidth:3,dot:{fill:"#10b981",strokeWidth:2,r:4},activeDot:{r:6,stroke:"#10b981",strokeWidth:2}}),t.jsx(fe,{type:"monotone",dataKey:"withdrawals",stroke:"#ef4444",strokeWidth:3,dot:{fill:"#ef4444",strokeWidth:2,r:4},activeDot:{r:6,stroke:"#ef4444",strokeWidth:2}})]})})}),t.jsxs("div",{className:"flex items-center justify-center gap-6 mt-4",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),t.jsx("span",{className:"text-sm text-gray-600",children:r("clients_page.deposits")})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full"}),t.jsx("span",{className:"text-sm text-gray-600",children:r("clients_page.withdrawals")})]})]})]})]}),t.jsxs(H,{children:[t.jsxs(Z,{children:[t.jsxs(Q,{className:"flex items-center gap-2",children:[t.jsx(E,{className:"h-5 w-5 text-purple-600"}),r("clients_page.payment_method_distribution")]}),t.jsx(ee,{children:r("clients_page.volume_breakdown_payment")})]}),t.jsx(te,{children:t.jsx("div",{className:"h-80",children:t.jsx(ue,{width:"100%",height:"100%",children:t.jsxs(_e,{children:[t.jsx(Ne,{data:ta(),cx:"50%",cy:"50%",innerRadius:60,outerRadius:120,paddingAngle:5,dataKey:"volume",children:ta().map((e,s)=>t.jsx(ve,{fill:sa[s%sa.length]},`cell-${s}`))}),t.jsx(be,{formatter:e=>[Ds(e,"â‚º"),"Volume"],contentStyle:{backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)"}}),t.jsx(we,{verticalAlign:"bottom",height:36,formatter:e=>t.jsx("span",{className:"text-sm text-gray-700",children:e})})]})})})})]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[t.jsxs(H,{children:[t.jsxs(Z,{children:[t.jsxs(Q,{className:"flex items-center gap-2",children:[t.jsx(f,{className:"h-5 w-5 text-green-600"}),r("clients_page.top_client_performance")]}),t.jsx(ee,{children:r("clients_page.volume_by_client_ranking")})]}),t.jsx(te,{children:t.jsx("div",{className:"h-80",children:t.jsx(ue,{width:"100%",height:"100%",children:t.jsxs(Ce,{data:ke.map(e=>({name:e.client_name,volume:e.total_amount,transactions:e.transaction_count,avgTransaction:e.avg_transaction,commission:e.total_commission})).sort((e,t)=>t.volume-e.volume).slice(0,10),children:[t.jsx(pe,{strokeDasharray:"3 3",stroke:"#f3f4f6"}),t.jsx(ye,{dataKey:"name",stroke:"#6b7280",fontSize:10,angle:-45,textAnchor:"end",height:80,tickFormatter:e=>e.length>12?e.substring(0,12)+"...":e}),t.jsx(je,{stroke:"#6b7280",fontSize:12,tickFormatter:e=>Ds(e,"â‚º")}),t.jsx(be,{formatter:e=>[Ds(e,"â‚º"),"Volume"],contentStyle:{backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)"}}),t.jsx(Se,{dataKey:"volume",fill:"#3b82f6",radius:[4,4,0,0]})]})})})})]}),t.jsxs(H,{children:[t.jsxs(Z,{children:[t.jsxs(Q,{className:"flex items-center gap-2",children:[t.jsx(T,{className:"h-5 w-5 text-blue-600"}),r("clients_page.currency_distribution")]}),t.jsx(ee,{children:r("clients_page.volume_breakdown_currency")})]}),t.jsx(te,{children:t.jsx("div",{className:"h-80",children:t.jsx(ue,{width:"100%",height:"100%",children:t.jsxs(Ce,{data:(()=>{const e=Re.reduce((e,t)=>{const s=t.currency||"Unknown";return e[s]||(e[s]={currency:s,volume:0,count:0}),e[s].volume+=Math.abs(t.amount),e[s].count+=1,e},{});return Object.values(e).sort((e,t)=>t.volume-e.volume)})(),children:[t.jsx(pe,{strokeDasharray:"3 3",stroke:"#f3f4f6"}),t.jsx(ye,{dataKey:"currency",stroke:"#6b7280",fontSize:12}),t.jsx(je,{stroke:"#6b7280",fontSize:12,tickFormatter:e=>Ds(e,"â‚º")}),t.jsx(be,{formatter:e=>[Ds(e,"â‚º"),"Volume"],contentStyle:{backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)"}}),t.jsx(Se,{dataKey:"volume",fill:"#8b5cf6",radius:[4,4,0,0]})]})})})})]})]})]}),t.jsx(he,{value:"clients",className:"mt-6",children:t.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:[t.jsx("div",{className:"px-8 py-6 border-b border-gray-100",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 bg-gray-100 rounded-xl flex items-center justify-center",children:t.jsx(u,{className:"w-5 h-5 text-gray-600"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:r("clients_page.client_information")}),t.jsx("p",{className:"text-sm text-gray-500",children:r("clients_page.manage_client_relationships")})]})]}),t.jsx("div",{className:"flex items-center gap-3"})]})}),t.jsx("div",{className:"p-8",children:Ue?t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-600"})}):t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"border-b border-gray-100",children:[t.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-600",children:r("clients_page.client")}),t.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-600",children:r("clients_page.company")}),t.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-600",children:r("clients.total_amount")}),t.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-600",children:r("clients_page.transactions")}),t.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-600",children:r("clients_page.last_transaction")}),t.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-600",children:r("common.actions")})]})}),t.jsx("tbody",{children:Is.length>0?Is.map((e,s)=>t.jsx(R.Fragment,{children:t.jsxs("tr",{className:"border-b border-gray-50 hover:bg-gray-50 hover:scale-[1.01] transition-all duration-300 ease-in-out cursor-pointer",children:[t.jsx("td",{className:"py-4 px-4",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center",children:t.jsx("span",{className:"text-sm font-medium text-gray-600",children:e.client_name.charAt(0).toUpperCase()})}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:e.client_name}),t.jsx("div",{className:"text-sm text-gray-500",children:e.company_name||r("common.na","N/A")})]})]})}),t.jsx("td",{className:"py-4 px-4",children:t.jsx("div",{className:"text-sm text-gray-900",children:e.company_name||r("common.na","N/A")})}),t.jsx("td",{className:"py-4 px-4",children:t.jsx("div",{className:"text-sm font-medium text-gray-900",children:Ds(e.total_amount,"TL")})}),t.jsx("td",{className:"py-4 px-4",children:t.jsx("div",{className:"text-sm text-gray-600",children:e.transaction_count})}),t.jsx("td",{className:"py-4 px-4",children:t.jsx("div",{className:"text-sm text-gray-600",children:e.last_transaction?new Date(e.last_transaction).toLocaleDateString():r("common.na","N/A")})}),t.jsx("td",{className:"py-4 px-4",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(oe,{variant:"outline",size:"sm",onClick:()=>(e=>{He(e),Zt(!0)})(e),className:"text-gray-600 hover:text-gray-700",children:t.jsx(o,{className:"w-4 h-4"})}),t.jsx(oe,{variant:"outline",size:"sm",onClick:()=>(e=>{He(e),es(!0)})(e),className:"text-green-600 hover:text-green-700",children:t.jsx(d,{className:"w-4 h-4"})}),t.jsx(oe,{variant:"outline",size:"sm",onClick:()=>(e=>{He(e),Ve(!0)})(e),className:"text-red-600 hover:text-red-700",children:t.jsx(m,{className:"w-4 h-4"})})]})})]})},s)):t.jsx("tr",{children:t.jsx("td",{colSpan:6,className:"py-12 text-center text-gray-500",children:Et.client_name?r("clients_page.no_clients_matching",{name:Et.client_name}):r("clients.no_clients_found")})})})]})})})]})})]}),Xt&&Ke&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:t.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[t.jsx("div",{className:"p-6 border-b border-gray-100",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:r("clients_page.client_details")}),t.jsx(oe,{onClick:Os,variant:"ghost",size:"icon-sm",className:"text-gray-400 hover:text-gray-600",children:t.jsx(a,{className:"h-5 w-5"})})]})}),t.jsxs("div",{className:"p-6 space-y-6",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"w-16 h-16 bg-accent-100 rounded-full flex items-center justify-center",children:t.jsx(c,{className:"h-8 w-8 text-accent-600"})}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-xl font-semibold text-gray-900",children:Ke.client_name}),t.jsx("p",{className:"text-gray-600",children:Ke.company_name||r("clients_page.no_company")})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsx("p",{className:"text-sm text-gray-600",children:r("clients.total_volume")}),t.jsx("p",{className:"text-xl font-bold text-gray-900",children:Ds(Ke.total_amount,Array.isArray(Ke.currencies)&&Ke.currencies.length>0?Ke.currencies[0]:"USD")})]}),t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsx("p",{className:"text-sm text-gray-600",children:r("clients_page.commissions")}),t.jsx("p",{className:"text-xl font-bold text-success-600",children:Ds(Ke.total_commission,Array.isArray(Ke.currencies)&&Ke.currencies.length>0?Ke.currencies[0]:"USD")})]}),t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsx("p",{className:"text-sm text-gray-600",children:r("clients_page.net_amount")}),t.jsx("p",{className:"text-xl font-bold text-accent-600",children:Ds(Ke.total_net,Array.isArray(Ke.currencies)&&Ke.currencies.length>0?Ke.currencies[0]:"USD")})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsx("p",{className:"text-sm text-gray-600",children:r("clients_page.transaction_count")}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:Ke.transaction_count})]}),t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsx("p",{className:"text-sm text-gray-600",children:r("clients.avg_transaction")}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:Ds(Ke.avg_transaction,Array.isArray(Ke.currencies)&&Ke.currencies.length>0?Ke.currencies[0]:"USD")})]})]}),t.jsxs("div",{className:"space-y-4",children:[Ke.payment_method&&t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(T,{className:"h-5 w-5 text-gray-400"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-gray-900",children:r("clients_page.payment_method")}),t.jsx("p",{className:"text-sm text-gray-600",children:Ke.payment_method})]})]}),Ke.currencies&&Ke.currencies.length>0&&t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-gray-900 mb-2",children:r("clients_page.currencies")}),t.jsx("div",{className:"flex flex-wrap gap-2",children:Ke.currencies.map(e=>t.jsx("span",{className:"inline-flex px-3 py-1 text-sm font-medium rounded-full bg-accent-100 text-accent-800",children:e},e))})]}),Ke.psps&&Ke.psps.length>0&&t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-gray-900 mb-2",children:r("clients_page.payment_service_providers")}),t.jsx("div",{className:"flex flex-wrap gap-2",children:Ke.psps.map(e=>t.jsx("span",{className:"inline-flex px-3 py-1 text-sm font-medium rounded-full bg-success-100 text-success-800",children:e},e))})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(k,{className:"h-5 w-5 text-gray-400"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-gray-900",children:r("clients_page.last_transaction")}),t.jsx("p",{className:"text-sm text-gray-600",children:Ke.last_transaction?(ra=Ke.last_transaction,ra?new Date(ra).toLocaleDateString():"N/A"):r("common.na","N/A")})]})]})]})]}),t.jsx("div",{className:"p-6 border-t border-gray-100",children:t.jsx(oe,{onClick:Os,variant:"outline",className:"w-full",children:r("common.close")})})]})}),Qt&&Ke&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:t.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[t.jsx("div",{className:"p-6 border-b border-gray-100",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:r("clients_page.edit_client")}),t.jsx("button",{onClick:Os,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors duration-200",children:t.jsx(a,{className:"h-5 w-5"})})]})}),t.jsxs("div",{className:"p-6",children:[t.jsx("p",{className:"text-gray-600 mb-6",children:r("clients_page.edit_functionality_placeholder")}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{onClick:Os,className:"flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors duration-200",children:r("common.cancel")}),t.jsx("button",{onClick:Os,className:"flex-1 px-4 py-2 bg-accent-600 text-white rounded-lg hover:bg-accent-700 transition-colors duration-200",children:r("clients_page.save_changes")})]})]})]})}),Ye&&Ke&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:t.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full",children:[t.jsx("div",{className:"p-6 border-b border-gray-100",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:r("clients_page.delete_client")}),t.jsx("button",{onClick:Os,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors duration-200",children:t.jsx(a,{className:"h-5 w-5"})})]})}),t.jsxs("div",{className:"p-6",children:[t.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[t.jsx("div",{className:"w-12 h-12 bg-danger-100 rounded-full flex items-center justify-center",children:t.jsx(m,{className:"h-6 w-6 text-danger-600"})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-lg font-semibold text-gray-900",children:r("clients_page.are_you_sure")}),t.jsx("p",{className:"text-gray-600",children:r("clients_page.action_cannot_undone")})]})]}),t.jsx("p",{className:"text-gray-600 mb-6",children:r("clients_page.about_to_delete",{name:Ke.client_name})}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{onClick:Os,disabled:qe,className:"flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors duration-200 disabled:opacity-50",children:r("common.cancel")}),t.jsx("button",{onClick:async()=>{if(Ke)try{Je(!0);const e=await K.delete(`/clients/${encodeURIComponent(Ke.client_name)}`);if(e.ok)De(e=>e.filter(e=>e.client_name!==Ke.client_name)),Ve(!1),He(null);else{const t=await K.parseResponse(e);alert(t?.message||r("transactions.failed_delete_client"))}}catch(e){alert(r("transactions.failed_delete_client"))}finally{Je(!1)}},disabled:qe,className:"flex-1 px-4 py-2 bg-danger-600 text-white rounded-lg hover:bg-danger-700 transition-colors duration-200 disabled:opacity-50",children:r(qe?"clients_page.deleting":"clients_page.delete_client")})]})]})]})}),rt&&lt&&t.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-6xl w-full max-h-[90vh] overflow-hidden border border-gray-200",children:[t.jsx("div",{className:"bg-white border-b border-gray-200 px-6 py-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(k,{className:"h-5 w-5 text-gray-700"}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:r("daily_summary.title")}),t.jsx("p",{className:"text-sm text-gray-500 mt-0.5",children:lt.date_str})]})]}),t.jsx("button",{onClick:()=>{nt(!1),it(null),mt("")},className:"w-8 h-8 bg-gray-100 rounded-lg flex items-center justify-center hover:bg-gray-200 transition-colors duration-200",children:t.jsx(a,{className:"h-4 w-4 text-gray-600"})})]})}),t.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-100px)]",children:ct?t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-gray-300 border-t-gray-600 mx-auto mb-3"}),t.jsx("p",{className:"text-gray-600 text-sm",children:r("daily_summary.loading_summary")})]})}):t.jsx("div",{className:"space-y-6",children:(()=>{const e=(e=>{if(lt&&lt.date===e)return{totalDeposits:lt.total_deposits_tl||0,totalWithdrawals:lt.total_withdrawals_tl||0,transactionCount:lt.transaction_count||0,uniqueClients:lt.unique_clients||0};if(Array.isArray(Re)){const t=Re.filter(t=>(t.date?t.date.split("T")[0]:null)===e),s=t.filter(e=>"DEP"===e.category||"Deposit"===e.category||"Investment"===e.category),a=t.filter(e=>"WD"===e.category||"Withdraw"===e.category||"Withdrawal"===e.category),r=s.reduce((e,t)=>{const s=null!==t.amount_tl&&void 0!==t.amount_tl?t.amount_tl:t.amount||0;return e+Math.abs(s)},0),n=a.reduce((e,t)=>{const s=null!==t.amount_tl&&void 0!==t.amount_tl?t.amount_tl:t.amount||0;return e+Math.abs(s)},0),l=t.length,i=new Set(t.map(e=>e.client_name).filter(e=>e)).size;if(l>0)return{totalDeposits:r,totalWithdrawals:n,transactionCount:l,uniqueClients:i}}return{totalDeposits:0,totalWithdrawals:0,transactionCount:0,uniqueClients:0}})(lt.date),s=e.totalDeposits+e.totalWithdrawals,a=(lt.total_deposits_tl||e.totalDeposits)-(lt.total_withdrawals_tl||e.totalWithdrawals),n=lt.total_commission_tl||0,l=e.transactionCount>0?s/e.transactionCount:0,i=Math.abs(a),c=i>0?n/i*100:0,o=lt.usd_rate||42.64;let d=lt.payment_method_totals?.BANK?.amount_usd||0;0===d&&lt.payment_method_totals?.BANK?.amount_tl&&(d=lt.payment_method_totals.BANK.amount_tl/o);let m=lt.payment_method_totals?.CC?.amount_usd||0;0===m&&lt.payment_method_totals?.CC?.amount_tl&&(m=lt.payment_method_totals.CC.amount_tl/o);const x=lt.payment_method_totals?.TETHER?.amount_usd||0;let h=0;lt.payment_method_summary&&Array.isArray(lt.payment_method_summary)&&lt.payment_method_summary.forEach(e=>{const t=(e=>{if(!e)return"OTHER";const t=e.toLowerCase();return t.includes("bank")||t.includes("banka")||t.includes("havale")||t.includes("eft")||t.includes("iban")||t.includes("transfer")||t.includes("wire")?"BANK":t.includes("kk")||t.includes("credit")||t.includes("card")||t.includes("kredi")||t.includes("visa")||t.includes("mastercard")||t.includes("amex")?"CC":t.includes("tether")||t.includes("usdt")||t.includes("crypto")||t.includes("kasa")?"TETHER":"OTHER"})(e.name||"");if("BANK"===t||"CC"===t){let t=e.commission_usd||0;0===t&&e.commission_tl&&(t=e.commission_tl/o),h+=t}}),0===h&&(h=lt.total_commission_usd||0);const g=d+m+x,p=d+m-h+x,y=Array.isArray(Re)?Re.filter(e=>(e.date?e.date.split("T")[0]:null)===lt.date):[],b=y.reduce((e,t)=>{const s=t.client_name||"Unknown";e[s]||(e[s]={total:0,count:0});const a=null!==t.amount_tl&&void 0!==t.amount_tl?t.amount_tl:t.amount||0;return e[s].total+=Math.abs(a),e[s].count+=1,e},{}),f=Object.entries(b).map(([e,t])=>({name:e,total:t.total,count:t.count})).sort((e,t)=>t.total-e.total).slice(0,5),_=y.filter(e=>"TRY"===e.currency||"TL"===e.currency),C=y.filter(e=>"USD"===e.currency),S=_.reduce((e,t)=>{const s=null!==t.amount_tl&&void 0!==t.amount_tl?t.amount_tl:t.amount||0;return e+Math.abs(s)},0),k=C.reduce((e,t)=>{const s=t.amount_usd||t.amount||0;return e+Math.abs(s)},0);return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-5",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2.5",children:[t.jsx("span",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:r("daily_summary.total_dep")}),t.jsx(j,{className:"h-4 w-4 text-gray-400"})]}),t.jsx("p",{className:"text-3xl font-semibold text-gray-900 mb-1",children:Ds(lt.total_deposits_tl||e.totalDeposits,"â‚º")}),t.jsxs("div",{className:"flex flex-col gap-1 text-xs text-gray-500 mt-2 pt-2 border-t border-gray-100",children:[t.jsxs("span",{children:["TRY: ",Ds(lt.total_deposits_tl||e.totalDeposits,"â‚º")]}),t.jsxs("span",{children:["USD: $",(lt.total_deposits_usd||0).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]}),t.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-5",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2.5",children:[t.jsx("span",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:r("daily_summary.total_wd")}),t.jsx(N,{className:"h-4 w-4 text-gray-400"})]}),t.jsx("p",{className:"text-3xl font-semibold text-gray-900 mb-1",children:Ds(lt.total_withdrawals_tl||e.totalWithdrawals,"â‚º")}),t.jsxs("div",{className:"flex flex-col gap-1 text-xs text-gray-500 mt-2 pt-2 border-t border-gray-100",children:[t.jsxs("span",{children:["TRY: ",Ds(lt.total_withdrawals_tl||e.totalWithdrawals,"â‚º")]}),t.jsxs("span",{children:["USD: $",(lt.total_withdrawals_usd||0).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]}),t.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-5",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2.5",children:[t.jsx("span",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:r("daily_summary.net")}),t.jsx(P,{className:"h-4 w-4 text-gray-400"})]}),t.jsx("p",{className:"text-3xl font-semibold mb-1 "+(a>=0?"text-gray-900":"text-red-600"),children:Ds(a,"â‚º")}),t.jsxs("div",{className:"flex flex-col gap-1 text-xs text-gray-500 mt-2 pt-2 border-t border-gray-100",children:[t.jsxs("span",{children:["TRY: ",Ds(a,"â‚º")]}),t.jsxs("span",{children:["USD: $",((lt.total_deposits_usd||0)-(lt.total_withdrawals_usd||0)).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]})]}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[t.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:r("daily_summary.total_bank")}),t.jsx(A,{className:"h-4 w-4 text-gray-400"})]}),t.jsx("p",{className:"text-2xl font-semibold text-gray-900 mb-1",children:Ds(lt.payment_method_totals?.BANK?.amount_tl||0,"â‚º")})]}),t.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:r("daily_summary.total_cc")}),t.jsx(A,{className:"h-4 w-4 text-gray-400"})]}),t.jsx("p",{className:"text-2xl font-semibold text-gray-900 mb-1",children:Ds(lt.payment_method_totals?.CC?.amount_tl||0,"â‚º")})]}),t.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:r("daily_summary.tether")}),t.jsx(v,{className:"h-4 w-4 text-gray-400"})]}),t.jsxs("p",{className:"text-2xl font-semibold text-gray-900 mb-1",children:["$",(lt.payment_method_totals?.TETHER?.amount_usd||0).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),t.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:r("daily_summary.commission")}),t.jsx(v,{className:"h-4 w-4 text-gray-400"})]}),t.jsx("p",{className:"text-2xl font-semibold text-gray-900 mb-1",children:Ds(n,"â‚º")}),t.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[c.toFixed(2),"% ",r("daily_summary.of_net")]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:r("daily_summary.net_cash_usd")}),t.jsx(v,{className:"h-4 w-4 text-gray-400"})]}),t.jsxs("p",{className:"text-2xl font-semibold mb-1 "+(g>=0?"text-gray-900":"text-red-600"),children:["$",g.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]}),t.jsx("p",{className:"text-xs text-gray-500 mt-2",children:r("daily_summary.without_commission")})]}),t.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:r("daily_summary.net_cash_usd_commission")}),t.jsx(v,{className:"h-4 w-4 text-gray-400"})]}),t.jsxs("p",{className:"text-2xl font-semibold mb-1 "+(p>=0?"text-gray-900":"text-red-600"),children:["$",p.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]}),t.jsx("p",{className:"text-xs text-gray-500 mt-2",children:r("daily_summary.with_commission")})]}),t.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:r("daily_summary.activity")}),t.jsx(u,{className:"h-4 w-4 text-gray-400"})]}),t.jsxs("div",{className:"space-y-1.5",children:[t.jsxs("div",{className:"flex justify-between items-center text-sm",children:[t.jsx("span",{className:"text-gray-600",children:r("daily_summary.transactions")}),t.jsx("span",{className:"font-semibold text-gray-900",children:e.transactionCount})]}),t.jsxs("div",{className:"flex justify-between items-center text-sm",children:[t.jsx("span",{className:"text-gray-600",children:r("daily_summary.clients")}),t.jsx("span",{className:"font-semibold text-gray-900",children:e.uniqueClients})]}),e.transactionCount>0&&t.jsxs("div",{className:"flex justify-between items-center text-sm pt-1 border-t border-gray-100",children:[t.jsx("span",{className:"text-gray-600",children:r("daily_summary.avg_value")}),t.jsx("span",{className:"font-semibold text-gray-900",children:Ds(l,"â‚º")})]})]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[null!==lt.usd_rate&&void 0!==lt.usd_rate&&t.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:r("daily_summary.usd_exchange_rate")}),t.jsx(v,{className:"h-4 w-4 text-gray-400"})]}),t.jsxs("p",{className:"text-xl font-semibold text-gray-900",children:[Number(lt.usd_rate).toFixed(2)," â‚º"]})]}),t.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:r("daily_summary.currency_distribution")}),t.jsx(T,{className:"h-4 w-4 text-gray-400"})]}),t.jsxs("div",{className:"space-y-1.5",children:[t.jsxs("div",{className:"flex justify-between items-center text-sm",children:[t.jsx("span",{className:"text-gray-600",children:r("daily_summary.try_volume")}),t.jsx("span",{className:"font-semibold text-gray-900",children:Ds(S,"â‚º")})]}),t.jsxs("div",{className:"flex justify-between items-center text-sm",children:[t.jsx("span",{className:"text-gray-600",children:r("daily_summary.usd_volume")}),t.jsxs("span",{className:"font-semibold text-gray-900",children:["$",k.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]})]}),f.length>0&&t.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:r("daily_summary.top_client")}),t.jsx(w,{className:"h-4 w-4 text-gray-400"})]}),t.jsx("p",{className:"text-sm font-semibold text-gray-900 truncate mb-1",children:f[0].name}),t.jsx("p",{className:"text-xs text-gray-600",children:Ds(f[0].total,"â‚º")})]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[lt.psp_summary.length>0&&t.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-5",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-4 pb-3 border-b border-gray-200",children:[t.jsx(L,{className:"h-4 w-4 text-gray-600"}),t.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:r("daily_summary.payment_service_providers")}),t.jsxs("span",{className:"ml-auto text-xs text-gray-500",children:[lt.psp_summary.length," ",r("daily_summary.psps")]})]}),t.jsxs("div",{className:"space-y-3",children:[lt.psp_summary.slice(0,5).map((e,s)=>{const a=e.is_tether||e.name&&(e.name.toLowerCase().includes("tether")||"TETHER"===e.name),n=a?e.gross_usd||e.amount_usd||0:e.gross_tl||e.amount_tl||0,l=a?e.commission_usd:e.commission_tl,i=a?e.net_usd:e.net_tl,c=a?"$":"â‚º";return t.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 border border-gray-100",children:[t.jsx("div",{className:"flex justify-between items-start mb-2",children:t.jsx("div",{className:"flex-1 min-w-0",children:t.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.name})})}),t.jsxs("div",{className:"grid grid-cols-3 gap-2 mt-2 pt-2 border-t border-gray-200",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-500 mb-0.5",children:r("daily_summary.gross")}),t.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:[c,n.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0})]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-500 mb-0.5",children:r("daily_summary.commission_label")}),t.jsxs("p",{className:"text-sm font-semibold text-gray-700",children:[c,l.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0})]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-500 mb-0.5",children:r("daily_summary.net")}),t.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:[c,i.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0})]})]})]})]},s)}),lt.psp_summary.length>5&&t.jsx("div",{className:"text-center pt-2 border-t border-gray-100",children:t.jsx("span",{className:"text-xs text-gray-500",children:r("daily_summary.more_psps",{count:lt.psp_summary.length-5})})})]})]}),lt.payment_method_summary.length>0&&t.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-5",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-4 pb-3 border-b border-gray-200",children:[t.jsx(A,{className:"h-4 w-4 text-gray-600"}),t.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:r("daily_summary.payment_methods")}),t.jsxs("span",{className:"ml-auto text-xs text-gray-500",children:[lt.payment_method_summary.length," ",r("daily_summary.methods")]})]}),t.jsxs("div",{className:"space-y-3",children:[lt.payment_method_summary.slice(0,5).map((e,s)=>{const a=e.name&&(e.name.toLowerCase().includes("tether")||"TETHER"===e.name),n=a?e.gross_usd||e.amount_usd||0:e.gross_tl||e.amount_tl||0,l=a?e.commission_usd:e.commission_tl,i=a?e.net_usd:e.net_tl,c=a?"$":"â‚º";return t.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 border border-gray-100",children:[t.jsx("div",{className:"flex justify-between items-start mb-2",children:t.jsx("div",{className:"flex-1 min-w-0",children:t.jsx("p",{className:"text-sm font-medium text-gray-900",children:qs(e.name)})})}),t.jsxs("div",{className:"grid grid-cols-3 gap-2 mt-2 pt-2 border-t border-gray-200",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-500 mb-0.5",children:r("daily_summary.gross")}),t.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:[c,n.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0})]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-500 mb-0.5",children:r("daily_summary.commission_label")}),t.jsxs("p",{className:"text-sm font-semibold text-gray-700",children:[c,l.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0})]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-500 mb-0.5",children:r("daily_summary.net")}),t.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:[c,i.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0})]})]})]})]},s)}),lt.payment_method_summary.length>5&&t.jsx("div",{className:"text-center pt-2 border-t border-gray-100",children:t.jsx("span",{className:"text-xs text-gray-500",children:r("daily_summary.more_methods",{count:lt.payment_method_summary.length-5})})})]})]})]})]})})()})})]})}),ts&&ns&&t.jsx(J,{isOpen:ts,onClose:()=>ss(!1),title:r("transactions.view_transaction"),children:t.jsx(G,{transaction:ns})}),as&&ns&&t.jsx(J,{isOpen:as,onClose:()=>rs(!1),title:r("transactions.edit_transaction"),children:t.jsx(z,{transaction:ns,onSave:e=>{Pe(t=>t.map(t=>t.id===e.id?e:t)),st[e.client_name]&&at(t=>({...t,[e.client_name]:t[e.client_name].map(t=>t.id===e.id?e:t)})),lt&&lt.date===e.date&&ea(e.date),rs(!1),window.dispatchEvent(new CustomEvent("transactionsUpdated",{detail:{action:"update",transactionId:e.id,skipCurrentPage:!0}}))},onCancel:()=>rs(!1),dropdownOptions:Dt})}),os&&t.jsx(J,{isOpen:os,onClose:()=>ds(!1),title:r("transactions.import_guide"),size:"lg",children:t.jsxs("div",{className:"space-y-6 max-h-96 overflow-y-auto",children:[t.jsxs("div",{children:[t.jsx("h5",{className:"text-sm font-medium text-gray-800 mb-2",children:"âœ… Supported File Formats:"}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full font-medium",children:"CSV (Fully Supported)"}),t.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full font-medium",children:"XLSX (Fully Supported)"}),t.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full font-medium",children:"XLS (Fully Supported)"}),t.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full font-medium",children:"XLSM (Fully Supported)"})]})]}),t.jsxs("div",{children:[t.jsx("h5",{className:"text-sm font-medium text-gray-800 mb-2",children:"ðŸŽ¯ Essential vs Optional Fields:"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[t.jsxs("div",{children:[t.jsx("h6",{className:"font-medium text-green-700 mb-1",children:"âœ… Essential Fields (Recommended):"}),t.jsxs("ul",{className:"text-green-600 space-y-1",children:[t.jsxs("li",{children:["â€¢ ",t.jsx("strong",{children:"Client"})," - Client's full name"]}),t.jsxs("li",{children:["â€¢ ",t.jsx("strong",{children:"Amount"})," - Transaction amount"]}),t.jsxs("li",{children:["â€¢ ",t.jsx("strong",{children:"Company"})," - Company name"]}),t.jsxs("li",{children:["â€¢ ",t.jsx("strong",{children:"Payment Method"})," - How payment was made"]}),t.jsxs("li",{children:["â€¢ ",t.jsx("strong",{children:"Category"})," - Transaction category"]}),t.jsxs("li",{children:["â€¢ ",t.jsx("strong",{children:"Currency"})," - Transaction currency"]}),t.jsxs("li",{children:["â€¢ ",t.jsx("strong",{children:"PSP"})," - Payment service provider"]}),t.jsxs("li",{children:["â€¢ ",t.jsx("strong",{children:"Date"})," - Transaction date"]})]})]}),t.jsxs("div",{children:[t.jsx("h6",{className:"font-medium text-gray-700 mb-1",children:"â“ Optional Fields:"}),t.jsxs("ul",{className:"text-gray-600 space-y-1",children:[t.jsxs("li",{children:["â€¢ ",t.jsx("strong",{children:"Commission"})," - Auto-calculated if not provided"]}),t.jsxs("li",{children:["â€¢ ",t.jsx("strong",{children:"Net Amount"})," - Auto-calculated if not provided"]}),t.jsxs("li",{children:["â€¢ ",t.jsx("strong",{children:"Notes"})," - Additional transaction details"]})]})]})]})]}),t.jsxs("div",{children:[t.jsx("h5",{className:"text-sm font-medium text-gray-800 mb-2",children:"ðŸ“‹ Essential Column Structure (in exact order):"}),t.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3 text-xs font-mono text-gray-700 overflow-x-auto",children:[t.jsxs("div",{className:"grid grid-cols-9 gap-1 text-center font-medium text-gray-600 mb-2",children:[t.jsx("div",{className:"col-span-1",children:"1"}),t.jsx("div",{className:"col-span-1",children:"2"}),t.jsx("div",{className:"col-span-1",children:"3"}),t.jsx("div",{className:"col-span-1",children:"4"}),t.jsx("div",{className:"col-span-1",children:"5"}),t.jsx("div",{className:"col-span-1",children:"6"}),t.jsx("div",{className:"col-span-1",children:"7"}),t.jsx("div",{className:"col-span-1",children:"8"}),t.jsx("div",{className:"col-span-1",children:"9"})]}),t.jsxs("div",{className:"grid grid-cols-9 gap-1 text-center",children:[t.jsx("div",{className:"col-span-1",children:"Client"}),t.jsx("div",{className:"col-span-1",children:"Company"}),t.jsx("div",{className:"col-span-1",children:"Payment"}),t.jsx("div",{className:"col-span-1",children:"Category"}),t.jsx("div",{className:"col-span-1",children:"Amount"}),t.jsx("div",{className:"col-span-1",children:"Currency"}),t.jsx("div",{className:"col-span-1",children:"PSP"}),t.jsx("div",{className:"col-span-1",children:"Date"})]}),t.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[t.jsx("div",{className:"text-xs text-gray-600 text-center mb-2",children:"Optional Columns (if needed):"}),t.jsxs("div",{className:"grid grid-cols-3 gap-1 text-center text-xs",children:[t.jsx("div",{className:"col-span-1",children:"10"}),t.jsx("div",{className:"col-span-1",children:"11"}),t.jsx("div",{className:"col-span-1",children:"12"})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-1 text-center text-xs",children:[t.jsx("div",{className:"col-span-1",children:"Commission"}),t.jsx("div",{className:"col-span-1",children:"Net Amount"}),t.jsx("div",{className:"col-span-1",children:"Notes"})]})]})]})]}),t.jsxs("div",{children:[t.jsx("h5",{className:"text-sm font-medium text-gray-800 mb-2",children:"ðŸ’¡ Example File Formats:"}),t.jsxs("div",{className:"mb-3",children:[t.jsx("h6",{className:"text-sm font-medium text-gray-700 mb-2",children:"ðŸ“„ CSV Format (Essential Columns):"}),t.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3 text-xs font-mono text-gray-700 overflow-x-auto",children:[t.jsx("div",{className:"text-gray-600 font-medium mb-1",children:"Essential Header Row:"}),t.jsx("div",{className:"text-gray-800",children:"Client,Company,Payment Method,Category,Amount,Currency,PSP,Date"}),t.jsx("div",{className:"text-gray-600 font-medium mt-2 mb-1",children:"Essential Data Row (Example):"}),t.jsx("div",{className:"text-gray-800",children:"John Doe,ABC Corp,Credit Card,DEP,1000.50,USD,Stripe,2025-08-18"}),t.jsxs("div",{className:"mt-3 pt-2 border-t border-gray-200",children:[t.jsx("div",{className:"text-gray-600 font-medium mb-1",children:"Full Header Row (with optional columns):"}),t.jsx("div",{className:"text-gray-800",children:"Client,Company,Payment Method,Category,Amount,Commission,Net Amount,Currency,PSP,Date,Notes"}),t.jsx("div",{className:"text-gray-600 font-medium mt-2 mb-1",children:"Full Data Row (Example):"}),t.jsx("div",{className:"text-gray-800",children:"John Doe,ABC Corp,Credit Card,DEP,1000.50,25.00,975.50,USD,Stripe,2025-08-18,Monthly payment"})]})]})]}),t.jsxs("div",{children:[t.jsx("h6",{className:"text-sm font-medium text-gray-700 mb-2",children:"ðŸ“Š Excel Format (XLSX/XLS/XLSM):"}),t.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3 text-xs font-mono text-gray-700 overflow-x-auto",children:[t.jsx("div",{className:"text-gray-600 font-medium mb-1",children:"Essential Column Structure:"}),t.jsx("div",{className:"text-gray-800",children:"Column A: Client | Column B: Company | Column C: Payment Method"}),t.jsx("div",{className:"text-gray-800",children:"Column D: Category | Column E: Amount | Column F: Currency | Column G: PSP | Column H: Date"}),t.jsxs("div",{className:"mt-3 pt-2 border-t border-gray-200",children:[t.jsx("div",{className:"text-gray-600 font-medium mb-1",children:"Optional Columns (if needed):"}),t.jsx("div",{className:"text-gray-800",children:"Column J: Commission | Column K: Net Amount | Column L: Notes"})]}),t.jsx("div",{className:"text-gray-600 font-medium mt-2 mb-1",children:"ðŸ’¡ Tip: Excel files are automatically parsed - just ensure your first row contains headers!"})]})]})]}),t.jsxs("div",{children:[t.jsx("h5",{className:"text-sm font-medium text-gray-800 mb-2",children:"ðŸ“¥ Download Template Examples:"}),t.jsxs("div",{className:"mb-3",children:[t.jsx("h6",{className:"text-sm font-medium text-green-700 mb-2",children:"âœ… Essential Template (9 columns):"}),t.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:[t.jsxs("div",{className:"text-sm text-green-800 mb-2",children:[t.jsx("strong",{children:"Perfect for most imports:"})," Contains only the essential columns needed for complete transaction data."]}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsxs("button",{onClick:()=>aa("essential","csv"),className:"px-3 py-1.5 bg-green-600 text-white text-xs rounded-lg hover:bg-green-700 transition-colors duration-200 flex items-center gap-1",children:[t.jsx(n,{className:"w-3 h-3"}),"Download CSV Template"]}),t.jsxs("button",{onClick:()=>aa("essential","xlsx"),className:"px-3 py-1.5 bg-green-600 text-white text-xs rounded-lg hover:bg-green-700 transition-colors duration-200 flex items-center gap-1",children:[t.jsx(n,{className:"w-3 h-3"}),"Download Excel Template"]})]})]})]}),t.jsxs("div",{children:[t.jsx("h6",{className:"text-sm font-medium text-gray-700 mb-2",children:"ðŸ“‹ Full Template (12 columns):"}),t.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3",children:[t.jsxs("div",{className:"text-sm text-gray-800 mb-2",children:[t.jsx("strong",{children:"Complete template:"})," Includes all columns including commission, net amount, and notes for advanced users."]}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsxs("button",{onClick:()=>aa("full","csv"),className:"px-3 py-1.5 bg-gray-600 text-white text-xs rounded-lg hover:bg-gray-700 transition-colors duration-200 flex items-center gap-1",children:[t.jsx(n,{className:"w-3 h-3"}),"Download CSV Template"]}),t.jsxs("button",{onClick:()=>aa("full","xlsx"),className:"px-3 py-1.5 bg-gray-600 text-white text-xs rounded-lg hover:bg-gray-700 transition-colors duration-200 flex items-center gap-1",children:[t.jsx(n,{className:"w-3 h-3"}),"Download Excel Template"]})]})]})]})]}),t.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:[t.jsx("h6",{className:"text-sm font-medium text-green-800 mb-1",children:"ðŸ§® Smart Import Features:"}),t.jsxs("ul",{className:"text-sm text-green-700 space-y-1",children:[t.jsxs("li",{children:["â€¢ ",t.jsx("strong",{children:"Essential 9 columns"})," provide complete transaction data"]}),t.jsxs("li",{children:["â€¢ ",t.jsx("strong",{children:"Commission & Net Amount"})," are auto-calculated if not provided"]}),t.jsxs("li",{children:["â€¢ ",t.jsx("strong",{children:"Transaction summaries"})," are automatically generated"]}),t.jsxs("li",{children:["â€¢ ",t.jsx("strong",{children:"Client statistics"})," are updated in real-time"]}),t.jsxs("li",{children:["â€¢ ",t.jsx("strong",{children:"Flexible import"})," - use 9 essential columns or all 12 columns"]}),t.jsxs("li",{children:["â€¢ Only import ",t.jsx("strong",{children:"raw data"})," - let the system handle calculations!"]})]})]})]})}),ms&&t.jsx(J,{isOpen:ms,onClose:()=>xs(!1),title:r("transactions.import_preview"),size:"lg",children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[t.jsx("h5",{className:"text-sm font-medium text-gray-800 mb-2",children:"ðŸ“Š Import Summary:"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[t.jsxs("div",{children:[t.jsxs("span",{className:"text-gray-600 font-medium",children:[r("clients.total_transactions"),":"]}),t.jsx("span",{className:"ml-2 text-gray-800",children:hs.length})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-600 font-medium",children:"File Type:"}),t.jsx("span",{className:"ml-2 text-gray-800",children:"CSV"})]})]})]}),t.jsxs("div",{children:[t.jsx("h5",{className:"text-sm font-medium text-gray-800 mb-3",children:"ðŸ‘€ Preview (First 5 transactions):"}),t.jsx("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Client"}),t.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Company"}),t.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),t.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Currency"}),t.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Category"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:gs.map((e,s)=>t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-sm text-gray-900",children:e.client_name}),t.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-sm text-gray-900",children:e.company||"-"}),t.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-sm font-medium text-gray-900",children:e.amount}),t.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-sm text-gray-500",children:e.currency}),t.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-sm text-gray-500",children:e.category})]},s))})]})})]}),t.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200",children:[t.jsx("button",{onClick:()=>xs(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",children:"Cancel"}),t.jsx("button",{onClick:async()=>{if(hs&&0!==hs.length){cs(!0);try{const e=hs.map(e=>({client_name:e.client_name,company:e.company||"",payment_method:e.payment_method||"",category:e.category,amount:e.amount,commission:e.commission||0,net_amount:e.net_amount||e.amount,currency:e.currency||"TL",psp:e.psp||"",notes:e.notes||"",date:e.date||(new Date).toISOString().split("T")[0]})),t=await K.post("/transactions/bulk-import",{transactions:e});if(t.ok){const e=await K.parseResponse(t);let s="Import completed successfully!\n\n";s+="ðŸ“Š Import Summary:\n",s+=`âœ… Successfully imported: ${e.data.successful_imports} transactions\n`,s+=`âŒ Failed imports: ${e.data.failed_imports} transactions\n`,s+=`âš ï¸ Duplicates skipped: ${e.data.skipped_duplicates} transactions\n`,s+=`ðŸ“ Total rows processed: ${e.data.total_rows}\n`,e.data.warnings&&e.data.warnings.length>0&&(s+="\nâš ï¸ Warnings:\n",e.data.warnings.slice(0,5).forEach(e=>{s+=`â€¢ ${e}\n`}),e.data.warnings.length>5&&(s+=`â€¢ ... and ${e.data.warnings.length-5} more warnings\n`)),e.data.errors&&e.data.errors.length>0&&(s+="\nâŒ Errors:\n",e.data.errors.slice(0,5).forEach(e=>{s+=`â€¢ ${e}\n`}),e.data.errors.length>5&&(s+=`â€¢ ... and ${e.data.errors.length-5} more errors\n`)),e.data.summary&&(s+="\nðŸ’° Summary:\n",s+=`â€¢ Total amount imported: ${e.data.summary.total_amount?.toLocaleString()||"N/A"} â‚º\n`,s+=`â€¢ Categories imported: ${e.data.summary.categories_imported?.join(", ")||"N/A"}\n`),alert(s),xs(!1),us([]),ps([]),"transactions"===Wt&&Ns(),Ss()}else alert(`${r("transactions.import_failed")}: ${t.statusText||"Unknown error"}`)}catch(e){alert(`${r("transactions.import_error")}: ${e.message||"Unknown error occurred"}`)}finally{cs(!1)}}else alert(r("transactions.no_data_import"))},disabled:is,className:"px-4 py-2 text-sm font-medium text-white bg-gray-600 border border-transparent rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 disabled:opacity-50 disabled:cursor-not-allowed",children:is?"Importing...":`Import ${hs.length} Transactions`})]})]})}),ys&&t.jsx(J,{isOpen:ys,onClose:()=>{js(!1),fs("")},title:r("clients_page.paste_import_transactions"),size:"lg",children:t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:t.jsxs("p",{className:"text-sm text-blue-800",children:[t.jsx("strong",{children:"Format:"})," Tab-separated values (her satÄ±r bir transaction)",t.jsx("br",{}),t.jsx("strong",{children:"Kolonlar:"})," MÃ¼ÅŸteri AdÄ± | Ã–deme YÃ¶ntemi | Åžirket | ORDER | Tarih (DD.MM.YYYY) | Kategori (YATIRIM/Ã‡EKME) | Tutar | Komisyon | Net Tutar | Para Birimi | PSP | MÃœÅžTERÄ°"]})}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"pasteData",className:"block text-sm font-medium text-gray-700 mb-2",children:"Transaction Verileri (Tab-separated):"}),t.jsx("textarea",{id:"pasteData",value:bs,onChange:e=>fs(e.target.value),placeholder:"Verileri buraya yapÄ±ÅŸtÄ±rÄ±n...",className:"w-full h-64 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 font-mono text-sm"}),t.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[bs.split("\n").filter(e=>e.trim()).length," satÄ±r tespit edildi"]})]}),t.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200",children:[t.jsx("button",{onClick:()=>{js(!1),fs("")},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:"Ä°ptal"}),t.jsx("button",{onClick:async()=>{if(bs.trim())try{const e=(e=>{const t=[],s=e.trim().split("\n"),a=e=>{const t=e.replace(/\./g,"").replace(",",".");return parseFloat(t)||0},r=e=>{try{const t=e.split(".");if(3===t.length){const e=t[0].padStart(2,"0"),s=t[1].padStart(2,"0");return`${t[2]}-${s}-${e}`}return null}catch{return null}},n=e=>{const t=e.trim().toUpperCase();return"YATIRIM"===t?"DEP":"Ã‡EKME"===t?"WD":"DEP"};for(const l of s){if(!l.trim())continue;const e=l.split("\t");if(e.length<12)continue;const s=e[0].trim(),i=e[1].trim(),c=e[2].trim(),o=e[4].trim(),d=e[5].trim(),m=e[6].trim(),x=e[7].trim(),h=e[8].trim(),u=e[9].trim(),g=e[10].trim(),p=r(o);if(!p)continue;const y=n(d);let j=a(m);const b=a(x);let f=a(h);"WD"===y&&j>0&&(j=-j,f=-f);const _={id:0,client_name:s,company:c||"Unknown",payment_method:i,category:y,date:p,amount:j,commission:b,net_amount:f,currency:u,psp:g,notes:""};"USD"===u&&(_.exchange_rate=42.6),t.push(_)}return t})(bs);if(0===e.length)return void alert("Parse edilen transaction bulunamadÄ±. LÃ¼tfen veri formatÄ±nÄ± kontrol edin.");cs(!0);const t=e.map(e=>({client_name:e.client_name,company:e.company||"",payment_method:e.payment_method||"",category:e.category,amount:e.amount,commission:e.commission||0,net_amount:e.net_amount||e.amount,currency:e.currency||"TL",psp:e.psp||"",notes:e.notes||"",date:e.date||(new Date).toISOString().split("T")[0],exchange_rate:e.exchange_rate})),s=await K.post("/transactions/bulk-import",{transactions:t});if(s.ok){const e=await K.parseResponse(s);let t="Import tamamlandÄ±!\n\n";t+=`âœ… BaÅŸarÄ±lÄ±: ${e.data.successful_imports} transaction\n`,t+=`âŒ BaÅŸarÄ±sÄ±z: ${e.data.failed_imports} transaction\n`,t+=`âš ï¸ AtlandÄ±: ${e.data.skipped_duplicates} transaction\n`,t+=`ðŸ“ Toplam iÅŸlenen: ${e.data.total_rows} satÄ±r\n`,e.data.warnings&&e.data.warnings.length>0&&(t+="\nâš ï¸ UyarÄ±lar:\n",e.data.warnings.slice(0,5).forEach(e=>{t+=`â€¢ ${e}\n`})),e.data.errors&&e.data.errors.length>0&&(t+="\nâŒ Hatalar:\n",e.data.errors.slice(0,5).forEach(e=>{t+=`â€¢ ${e}\n`})),alert(t),js(!1),fs(""),"transactions"===Wt&&await Ns(),await Ss(),await Js()}else{const e=await K.parseResponse(s);alert(`Import baÅŸarÄ±sÄ±z: ${e.error||"Bilinmeyen hata"}`)}}catch(e){alert(`Import hatasÄ±: ${e.message||"Bilinmeyen hata oluÅŸtu"}`)}finally{cs(!1)}else alert("LÃ¼tfen veri yapÄ±ÅŸtÄ±rÄ±n")},disabled:is||!bs.trim(),className:"px-4 py-2 text-sm font-medium text-white bg-purple-600 border border-transparent rounded-md hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed",children:is?"Importing...":"Import Et"})]})]})}),Ge&&t.jsx(J,{isOpen:Ge,onClose:()=>Xe(!1),title:r("transactions.bulk_delete_all"),size:"md",children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx(h,{className:"w-5 h-5 text-red-600"}),t.jsx("h5",{className:"text-sm font-medium text-red-800",children:"âš ï¸ DANGER ZONE"})]}),t.jsxs("p",{className:"text-sm text-red-700",children:["This action will ",t.jsx("strong",{children:"permanently delete ALL transactions"})," from the system. This action cannot be undone and will affect all client data, reports, and analytics."]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"confirmationCode",className:"block text-sm font-medium text-gray-700 mb-2",children:"Enter Confirmation Code:"}),t.jsx("input",{type:"text",id:"confirmationCode",value:Ze,onChange:e=>Qe(e.target.value),placeholder:"Enter 4-digit code",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-gray-500",maxLength:4,autoComplete:"off"}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"You must enter the exact 4-digit confirmation code to proceed with deletion."})]}),t.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200",children:[t.jsx("button",{onClick:()=>Xe(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",children:"Cancel"}),t.jsx("button",{onClick:async()=>{if("4561"===Ze){if(confirm(r("transactions.confirm_delete_all"))){tt(!0);try{const t=await K.post("/transactions/bulk-delete",{confirmation_code:Ze});if(t.ok){const s=await K.parseResponse(t);alert(r("transactions.deleted_success").replace("{count}",s.data.deleted_count)),Xe(!1),Qe(""),Ks(null),Ys(0);try{localStorage.removeItem("pipeline_transactions_data"),localStorage.removeItem("pipeline_clients_data"),localStorage.removeItem("pipeline_dashboard_cache")}catch(e){}Pe([]),De([]),le.current=!1,await _s(),await Js()}else{const e=await K.parseResponse(t);alert(`${r("transactions.bulk_delete_failed")}: ${e.error||"Unknown error"}`)}}catch(t){alert(`${r("transactions.bulk_delete_failed")}: ${t.message||"Unknown error"}`)}finally{tt(!1)}}}else alert(r("transactions.invalid_confirmation_code"))},disabled:et||"4561"!==Ze,className:"px-4 py-2 text-sm font-medium text-white bg-red-600 border border-transparent rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed",children:et?"Deleting...":"Delete All Transactions"})]})]})}),ut&&t.jsx(J,{isOpen:ut,onClose:Qs,title:`${r("exchange_rates.edit_rate")} - ${pt}`,size:"md",children:t.jsxs("div",{className:"space-y-6",children:[t.jsx(H,{className:"p-4",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center",children:t.jsx(y,{className:"w-4 h-4 text-gray-600"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h5",{className:"text-sm font-medium text-gray-900 mb-1",children:r("clients.exchange_rate_modal.exchange_rate_label")}),t.jsx("p",{className:"text-sm text-gray-600 leading-relaxed",children:r("clients.exchange_rate_modal.description",{date:pt})})]})]})}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:r("clients.exchange_rate_modal.exchange_rate_label")}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx(ae,{type:"number",step:"0.0001",min:"0",value:jt,onChange:e=>bt(e.target.value),className:"flex-1",placeholder:r("clients.exchange_rate_modal.enter_rate_placeholder"),disabled:ft}),t.jsxs(Y,{onClick:()=>{vt(!0),Ct(pt)},disabled:ft,variant:"secondary",className:"flex items-center gap-2 whitespace-nowrap",children:[t.jsx(F,{className:"w-4 h-4"}),r("clients.exchange_rate_modal.select_date")]})]}),t.jsx("p",{className:"text-xs text-gray-500",children:r("clients.exchange_rate_modal.rate_example")})]}),jt&&parseFloat(jt)>0&&t.jsxs(H,{className:"p-4",children:[t.jsx("h5",{className:"text-sm font-medium text-gray-900 mb-3",children:r("clients.exchange_rate_modal.preview")}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100 last:border-b-0",children:[t.jsx("span",{className:"text-sm text-gray-600",children:r("clients.exchange_rate_modal.new_rate")}),t.jsxs("span",{className:"text-sm font-medium text-gray-900",children:["1 USD = ",parseFloat(jt).toFixed(4)," TRY"]})]}),t.jsxs("div",{className:"flex justify-between items-center py-2",children:[t.jsx("span",{className:"text-sm text-gray-600",children:r("clients.exchange_rate_modal.inverse")}),t.jsxs("span",{className:"text-sm font-medium text-gray-900",children:["1 TRY = ",(1/parseFloat(jt)).toFixed(6)," USD"]})]})]})]}),t.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200",children:[t.jsx(Y,{onClick:Qs,disabled:ft,variant:"outline",children:r("common.cancel")}),t.jsx(Y,{onClick:async()=>{if(pt&&jt)try{_t(!0);const e=parseFloat(jt);if(isNaN(e)||e<=0)return void alert(r("transactions.invalid_rate"));ht(t=>({...t,[pt]:{...t[pt],rate:e}}));const t=await K.put(`/exchange-rates/${pt}`,{rate:e});if(t.ok)await K.parseResponse(t),await Ns(),await Ts(Re),Qs(),alert(r("transactions.rate_updated_success").replace("{date}",pt));else{await Ts(Re);const e=await K.parseResponse(t);alert(`${r("transactions.failed_update_rate")}: ${e.error||"Unknown error"}`)}}catch(e){await Ts(Re),alert(r("transactions.failed_save_rate"))}finally{_t(!1)}},disabled:ft||!jt||parseFloat(jt)<=0,variant:"primary",children:r(ft?"clients.exchange_rate_modal.saving":"clients.exchange_rate_modal.save_rate")})]})]})}),Nt&&t.jsx(J,{isOpen:Nt,onClose:()=>vt(!1),title:r("exchange_rates.select_date"),size:"sm",children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs(H,{className:"p-4 text-center",children:[t.jsx("div",{className:"flex items-center justify-center w-12 h-12 mx-auto mb-4 rounded-full bg-gray-100",children:t.jsx(F,{className:"w-6 h-6 text-gray-600"})}),t.jsx("h5",{className:"text-sm font-medium text-gray-900 mb-2",children:r("clients.exchange_rate_modal.choose_date")}),t.jsx("p",{className:"text-sm text-gray-600 mb-4",children:r("clients.exchange_rate_modal.select_date_description")}),t.jsx(ae,{type:"date",value:wt,onChange:e=>Ct(e.target.value),className:"w-full max-w-xs mx-auto",max:(new Date).toISOString().split("T")[0]})]}),t.jsxs("div",{className:"flex justify-center gap-3",children:[t.jsx(Y,{onClick:()=>vt(!1),variant:"outline",children:r("common.cancel")}),t.jsx(Y,{onClick:()=>(async e=>{if(e)try{_t(!0),vt(!1);const t=await K.post(`/exchange-rates/${e}/fetch`);if(t.ok){const s=await K.parseResponse(t);if(s.success&&s.data){const t=s.data.rate;bt(t.toString()),yt(e)}else alert(r("transactions.yfinance_failed"))}else alert(r("transactions.yfinance_failed"))}catch(t){alert(r("transactions.yfinance_error"))}finally{_t(!1)}})(wt),disabled:!wt||ft,variant:"primary",children:r(ft?"clients.exchange_rate_modal.fetching":"clients.exchange_rate_modal.get_rate")})]})]})})]})]});var ra}export{Re as default};
