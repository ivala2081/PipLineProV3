import{r as s,j as e,U as a,G as t,aS as i,f as l,T as c,N as r,b as n,o as d,aP as x,C as m,L as o}from"./vendor-react-BhTnfaj4.js";import{a as h}from"./components-modern-tUvpuNx5.js";import{C as j,d as g,g as u,f as N,q as p,r as v,s as y,t as f,a as b,B as w,b as _}from"./components-ui-DqTPGewb.js";import"./contexts-BJ30luUC.js";import"./vendor-i18n-DHLiip7K.js";import"./vendor-utils-CtF19A-_.js";import"./vendor-charts-recharts-B9ou1qfH.js";import"./components-trust-Cyz_q_DS.js";function S(){const[S,L]=s.useState("overview"),[A,C]=s.useState(null),[k,E]=s.useState([]),[R,T]=s.useState([]),[M,$]=s.useState([]),[F,D]=s.useState(null),[P,z]=s.useState(!1),[I,U]=s.useState({username:"",ip_address:"",action:"",days:7});s.useEffect(()=>{V()},[]),s.useEffect(()=>{"sessions"===S?q():"logins"===S?(B(),G()):"audit"===S&&J()},[S,I]);const V=async()=>{try{const s=await h.get("/api/v1/security/security-overview");s.data.success&&C(s.data.overview)}catch(s){}},q=async()=>{z(!0);try{const s=await h.get("/api/v1/security/sessions");s.data.success&&E(s.data.sessions)}catch(s){}finally{z(!1)}},B=async()=>{z(!0);try{const s=new URLSearchParams;I.username&&s.append("username",I.username),I.ip_address&&s.append("ip_address",I.ip_address),s.append("days",I.days.toString());const e=await h.get(`/api/v1/security/login-attempts?${s}`);e.data.success&&T(e.data.attempts)}catch(s){}finally{z(!1)}},G=async()=>{try{const s=await h.get(`/api/v1/security/login-attempts/stats?days=${I.days}`);s.data.success&&D(s.data.stats)}catch(s){}},J=async()=>{z(!0);try{const s=new URLSearchParams;I.username&&s.append("username",I.username),I.action&&s.append("action",I.action),s.append("days",I.days.toString());const e=await h.get(`/api/v1/security/audit-logs?${s}`);e.data.success&&$(e.data.logs)}catch(s){}finally{z(!1)}},O=s=>new Date(s).toLocaleString(),Q=s=>{const e=Date.now()-new Date(s).getTime(),a=Math.floor(e/6e4),t=Math.floor(a/60),i=Math.floor(t/24);return i>0?`${i}d ago`:t>0?`${t}h ago`:a>0?`${a}m ago`:"Just now"};return e.jsxs("div",{className:"space-y-6",children:[A&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsx(j,{className:"border-l-4 border-l-blue-500",children:e.jsxs(g,{className:"pb-3",children:[e.jsxs(u,{className:"flex items-center gap-2 text-xs",children:[e.jsx(a,{className:"h-4 w-4 text-blue-500"}),"Active Sessions"]}),e.jsx(N,{className:"text-3xl font-bold text-blue-600",children:A.active_sessions})]})}),e.jsx(j,{className:"border-l-4 border-l-red-500",children:e.jsxs(g,{className:"pb-3",children:[e.jsxs(u,{className:"flex items-center gap-2 text-xs",children:[e.jsx(t,{className:"h-4 w-4 text-red-500"}),"Failed Logins (24h)"]}),e.jsx(N,{className:"text-3xl font-bold text-red-600",children:A.recent_failed_logins})]})}),e.jsx(j,{className:"border-l-4 border-l-orange-500",children:e.jsxs(g,{className:"pb-3",children:[e.jsxs(u,{className:"flex items-center gap-2 text-xs",children:[e.jsx(i,{className:"h-4 w-4 text-orange-500"}),"Locked Accounts"]}),e.jsx(N,{className:"text-3xl font-bold text-orange-600",children:A.locked_accounts})]})}),e.jsx(j,{className:"border-l-4 border-l-green-500",children:e.jsxs(g,{className:"pb-3",children:[e.jsxs(u,{className:"flex items-center gap-2 text-xs",children:[e.jsx(l,{className:"h-4 w-4 text-green-500"}),"Audit Entries (24h)"]}),e.jsx(N,{className:"text-3xl font-bold text-green-600",children:A.recent_audit_entries})]})}),e.jsx(j,{className:"border-l-4 border-l-purple-500",children:e.jsxs(g,{className:"pb-3",children:[e.jsxs(u,{className:"flex items-center gap-2 text-xs",children:[e.jsx(c,{className:"h-4 w-4 text-purple-500"}),"Critical Actions (7d)"]}),e.jsx(N,{className:"text-3xl font-bold text-purple-600",children:A.critical_actions_week})]})})]}),e.jsxs(p,{value:S,onValueChange:L,className:"w-full",children:[e.jsxs(v,{className:"grid w-full grid-cols-4 lg:w-[600px]",children:[e.jsxs(y,{value:"overview",className:"flex items-center gap-2",children:[e.jsx(r,{className:"h-4 w-4"}),"Overview"]}),e.jsxs(y,{value:"sessions",className:"flex items-center gap-2",children:[e.jsx(a,{className:"h-4 w-4"}),"Sessions"]}),e.jsxs(y,{value:"logins",className:"flex items-center gap-2",children:[e.jsx(i,{className:"h-4 w-4"}),"Login Attempts"]}),e.jsxs(y,{value:"audit",className:"flex items-center gap-2",children:[e.jsx(l,{className:"h-4 w-4"}),"Audit Logs"]})]}),e.jsx(f,{value:"overview",className:"space-y-4",children:e.jsxs(j,{children:[e.jsxs(g,{children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(r,{className:"h-5 w-5 text-indigo-600"}),"Security Dashboard"]}),e.jsx(u,{children:"Monitor system security status and recent activity"})]}),e.jsx(b,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700 mb-3",children:"Quick Actions"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(w,{variant:"outline",className:"w-full justify-start",onClick:()=>L("sessions"),children:[e.jsx(a,{className:"h-4 w-4 mr-2"}),"Manage Sessions"]}),e.jsxs(w,{variant:"outline",className:"w-full justify-start",onClick:()=>L("logins"),children:[e.jsx(c,{className:"h-4 w-4 mr-2"}),"Review Failed Logins"]}),e.jsxs(w,{variant:"outline",className:"w-full justify-start",onClick:()=>L("audit"),children:[e.jsx(l,{className:"h-4 w-4 mr-2"}),"View Audit Trail"]})]})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700 mb-3",children:"Security Status"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Session Security"}),e.jsxs(_,{variant:"default",className:"bg-green-500",children:[e.jsx(n,{className:"h-3 w-3 mr-1"}),"Active"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"CSRF Protection"}),e.jsxs(_,{variant:"default",className:"bg-green-500",children:[e.jsx(n,{className:"h-3 w-3 mr-1"}),"Enabled"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Rate Limiting"}),e.jsxs(_,{variant:"default",className:"bg-green-500",children:[e.jsx(n,{className:"h-3 w-3 mr-1"}),"Active"]})]})]})]})]})})]})}),e.jsx(f,{value:"sessions",className:"space-y-4",children:e.jsxs(j,{children:[e.jsx(g,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(N,{children:"Active Sessions"}),e.jsx(u,{children:"Manage active user sessions and force logout"})]}),e.jsxs(w,{onClick:q,variant:"outline",size:"sm",children:[e.jsx(d,{className:"h-4 w-4 mr-2"}),"Refresh"]})]})}),e.jsx(b,{children:P?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Loading sessions..."}):0===k.length?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(a,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No active sessions found"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"All users have been logged out"})]}):e.jsx("div",{className:"space-y-3",children:k.map(s=>e.jsx("div",{className:"p-4 border border-gray-200 rounded-lg hover:border-indigo-300 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(a,{className:"h-5 w-5 text-indigo-600"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:s.username}),e.jsx(_,{variant:"secondary",className:"text-xs",children:s.role})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 text-sm text-gray-600 mt-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{className:"h-4 w-4"}),e.jsx("span",{className:"font-mono",children:s.ip_address})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{className:"h-4 w-4"}),e.jsx("span",{children:Q(s.last_active)})]}),e.jsx("div",{className:"flex items-center gap-2",children:s.is_active?e.jsx(_,{variant:"default",className:"bg-green-500",children:"Active"}):e.jsx(_,{variant:"secondary",children:"Inactive"})})]})]}),s.is_active&&e.jsxs(w,{variant:"destructive",size:"sm",onClick:()=>(async s=>{if(confirm("Are you sure you want to terminate this session?"))try{(await h.delete(`/api/v1/security/sessions/${s}`)).data.success&&(q(),V())}catch(e){}})(s.id),children:[e.jsx(o,{className:"h-4 w-4 mr-2"}),"Logout"]})]})},s.id))})})]})}),e.jsxs(f,{value:"logins",className:"space-y-4",children:[F&&e.jsxs(j,{children:[e.jsxs(g,{children:[e.jsx(N,{children:"Login Statistics"}),e.jsxs(u,{children:["Last ",I.days," days"]})]}),e.jsxs(b,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:F.total_attempts}),e.jsx("div",{className:"text-xs text-gray-600",children:"Total Attempts"})]}),e.jsxs("div",{className:"text-center p-3 bg-red-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:F.failed_attempts}),e.jsx("div",{className:"text-xs text-gray-600",children:"Failed"})]}),e.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[F.success_rate,"%"]}),e.jsx("div",{className:"text-xs text-gray-600",children:"Success Rate"})]}),e.jsxs("div",{className:"text-center p-3 bg-orange-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:F.locked_accounts}),e.jsx("div",{className:"text-xs text-gray-600",children:"Locked Accounts"})]})]}),F.top_failed_ips.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700 mb-2",children:"Top Failed IPs"}),e.jsx("div",{className:"space-y-1",children:F.top_failed_ips.map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-mono text-gray-600",children:s.ip}),e.jsxs(_,{variant:"destructive",children:[s.count," failed"]})]},a))})]})]})]}),e.jsxs(j,{children:[e.jsx(g,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(N,{children:"Login Attempts"}),e.jsx(u,{children:"Monitor successful and failed login attempts"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{className:"px-3 py-1 border rounded-md text-sm",value:I.days,onChange:s=>U({...I,days:parseInt(s.target.value)}),children:[e.jsx("option",{value:1,children:"Last 24 hours"}),e.jsx("option",{value:7,children:"Last 7 days"}),e.jsx("option",{value:30,children:"Last 30 days"})]}),e.jsxs(w,{onClick:B,variant:"outline",size:"sm",children:[e.jsx(d,{className:"h-4 w-4 mr-2"}),"Refresh"]})]})]})}),e.jsx(b,{children:P?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Loading login attempts..."}):0===R.length?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(i,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No login attempts found"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Try adjusting the date range"})]}):e.jsx("div",{className:"space-y-2",children:R.map(s=>e.jsx("div",{className:"p-3 rounded-lg border "+(s.success?"bg-green-50 border-green-200":"bg-red-50 border-red-200"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s.success?e.jsx(n,{className:"h-5 w-5 text-green-600"}):e.jsx(t,{className:"h-5 w-5 text-red-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-900",children:s.username}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-mono",children:s.ip_address}),s.failure_reason&&e.jsxs("span",{className:"ml-2 text-red-600",children:["â€¢ ",s.failure_reason]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-gray-500",children:O(s.timestamp)}),e.jsx(_,{variant:s.success?"default":"destructive",className:s.success?"bg-green-500":"",children:s.success?"Success":"Failed"})]})]})},s.id))})})]})]}),e.jsx(f,{value:"audit",className:"space-y-4",children:e.jsxs(j,{children:[e.jsx(g,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(N,{children:"Audit Trail"}),e.jsx(u,{children:"Complete history of system activities"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{className:"px-3 py-1 border rounded-md text-sm",value:I.days,onChange:s=>U({...I,days:parseInt(s.target.value)}),children:[e.jsx("option",{value:7,children:"Last 7 days"}),e.jsx("option",{value:30,children:"Last 30 days"}),e.jsx("option",{value:90,children:"Last 90 days"})]}),e.jsxs(w,{onClick:J,variant:"outline",size:"sm",children:[e.jsx(d,{className:"h-4 w-4 mr-2"}),"Refresh"]})]})]})}),e.jsx(b,{children:P?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Loading audit logs..."}):0===M.length?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(l,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No audit logs found"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Audit logs are created when users perform actions like creating, editing, or deleting data"})]}):e.jsx("div",{className:"space-y-2",children:M.map(s=>e.jsx("div",{className:"p-3 border border-gray-200 rounded-lg hover:border-indigo-300 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(l,{className:"h-5 w-5 text-indigo-600 mt-0.5"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:s.username}),e.jsx(_,{variant:"DELETE"===s.action?"destructive":"CREATE"===s.action?"default":"secondary",className:"CREATE"===s.action?"bg-green-500":"",children:s.action}),e.jsxs("span",{className:"text-sm text-gray-600",children:[s.table_name," #",s.record_id]})]}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{className:"h-3 w-3"}),e.jsx("span",{className:"font-mono",children:s.ip_address})]}),s.new_values&&e.jsxs("div",{className:"text-xs bg-gray-50 p-2 rounded font-mono",children:[s.new_values.substring(0,100),s.new_values.length>100&&"..."]})]})]})]}),e.jsx("div",{className:"text-right text-sm text-gray-500",children:O(s.timestamp)})]})},s.id))})})]})})]})]})}export{S as default};
